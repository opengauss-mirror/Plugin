create schema db_explain_desc;
set current_schema to 'db_explain_desc';
create table ed_t(c1 int, c2 varchar(100), c3 int default 10);
insert into ed_t values(generate_series(1, 10), 'hello', 100);
-- 1.use explain to query table's info
explain ed_t;
 Field |          Type          | Null | Key | Default | Extra 
-------+------------------------+------+-----+---------+-------
 c1    | integer                | YES  |     | NULL    | 
 c2    | character varying(100) | YES  |     | NULL    | 
 c3    | integer                | YES  |     | 10      | 
(3 rows)

explain db_explain_desc.ed_t;
 Field |          Type          | Null | Key | Default | Extra 
-------+------------------------+------+-----+---------+-------
 c1    | integer                | YES  |     | NULL    | 
 c2    | character varying(100) | YES  |     | NULL    | 
 c3    | integer                | YES  |     | 10      | 
(3 rows)

-- 2.use desc to query plan info
desc select c1, c2, c3 from ed_t;
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on ed_t  (cost=0.00..13.19 rows=319 width=226)
(1 row)

desc insert into ed_t values(100, 'hello', 100);
                    QUERY PLAN                    
--------------------------------------------------
 [Bypass]
 Insert on ed_t  (cost=0.00..0.01 rows=1 width=0)
   ->  Result  (cost=0.00..0.01 rows=1 width=0)
(3 rows)

desc update ed_t set c2 = 'world' where c1 < 5;
                          QUERY PLAN                          
--------------------------------------------------------------
 Update on ed_t  (cost=0.00..13.99 rows=106 width=14)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=14)
         Filter: (c1 < 5)
(3 rows)

desc extended delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

describe select c1, c2, c3 from ed_t;
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on ed_t  (cost=0.00..13.19 rows=319 width=226)
(1 row)

describe insert into ed_t values(100, 'hello', 100);
                    QUERY PLAN                    
--------------------------------------------------
 [Bypass]
 Insert on ed_t  (cost=0.00..0.01 rows=1 width=0)
   ->  Result  (cost=0.00..0.01 rows=1 width=0)
(3 rows)

describe extended update ed_t set c2 = 'world' where c1 < 5;
                          QUERY PLAN                          
--------------------------------------------------------------
 Update on ed_t  (cost=0.00..13.99 rows=106 width=14)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=14)
         Filter: (c1 < 5)
(3 rows)

describe extended delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

desc format=json select c1, c2, c3 from ed_t;
           QUERY PLAN           
--------------------------------
 [                             +
   {                           +
     "Plan": {                 +
       "Node Type": "Seq Scan",+
       "Relation Name": "ed_t",+
       "Alias": "ed_t",        +
       "Startup Cost": 0.00,   +
       "Total Cost": 13.19,    +
       "Plan Rows": 319,       +
       "Plan Width": 226       +
     }                         +
   }                           +
 ]
(1 row)

describe format=traditional insert into ed_t values(100, 'hello', 100);
                    QUERY PLAN                    
--------------------------------------------------
 [Bypass]
 Insert on ed_t  (cost=0.00..0.01 rows=1 width=0)
   ->  Result  (cost=0.00..0.01 rows=1 width=0)
(3 rows)

-- 3.explain with key world: extended
explain extended select c1, c2, c3 from ed_t;
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on ed_t  (cost=0.00..13.19 rows=319 width=226)
(1 row)

explain extended insert into ed_t values(100, 'hello', 100);
                    QUERY PLAN                    
--------------------------------------------------
 [Bypass]
 Insert on ed_t  (cost=0.00..0.01 rows=1 width=0)
   ->  Result  (cost=0.00..0.01 rows=1 width=0)
(3 rows)

explain extended update ed_t set c2 = 'world' where c1 < 5;
                          QUERY PLAN                          
--------------------------------------------------------------
 Update on ed_t  (cost=0.00..13.99 rows=106 width=14)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=14)
         Filter: (c1 < 5)
(3 rows)

explain extended delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

-- 4.explain with specifying format(json or traditional)
explain format=json select c1, c2, c3 from ed_t;
           QUERY PLAN           
--------------------------------
 [                             +
   {                           +
     "Plan": {                 +
       "Node Type": "Seq Scan",+
       "Relation Name": "ed_t",+
       "Alias": "ed_t",        +
       "Startup Cost": 0.00,   +
       "Total Cost": 13.19,    +
       "Plan Rows": 319,       +
       "Plan Width": 226       +
     }                         +
   }                           +
 ]
(1 row)

explain format=json insert into ed_t values(100, 'hello', 100);
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Insert",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 0.01,                 +
       "Plan Rows": 1,                     +
       "Plan Width": 0,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Result",          +
           "Parent Relationship": "Member",+
           "Startup Cost": 0.00,           +
           "Total Cost": 0.01,             +
           "Plan Rows": 1,                 +
           "Plan Width": 0                 +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format=JSON update ed_t set c2 = 'world' where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Update",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 14,                   +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 14,               +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format=json delete from ed_t where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Delete",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 6,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 6,                +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format=Json delete from ed_t where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Delete",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 6,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 6,                +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format=JsOn delete from ed_t where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Delete",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 6,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 6,                +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format='JsOn' delete from ed_t where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Delete",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 6,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 6,                +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format='json' delete from ed_t where c1 < 5;
                 QUERY PLAN                 
--------------------------------------------
 [                                         +
   {                                       +
     "Plan": {                             +
       "Node Type": "ModifyTable",         +
       "Operation": "Delete",              +
       "Relation Name": "ed_t",            +
       "Alias": "ed_t",                    +
       "Startup Cost": 0.00,               +
       "Total Cost": 13.99,                +
       "Plan Rows": 106,                   +
       "Plan Width": 6,                    +
       "Plans": [                          +
         {                                 +
           "Node Type": "Seq Scan",        +
           "Parent Relationship": "Member",+
           "Relation Name": "ed_t",        +
           "Alias": "ed_t",                +
           "Startup Cost": 0.00,           +
           "Total Cost": 13.99,            +
           "Plan Rows": 106,               +
           "Plan Width": 6,                +
           "Filter": "(c1 < 5)"            +
         }                                 +
       ]                                   +
     }                                     +
   }                                       +
 ]
(1 row)

explain format=TRADITIONAL select c1, c2, c3 from ed_t;
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on ed_t  (cost=0.00..13.19 rows=319 width=226)
(1 row)

explain format=TRADITIONAL insert into ed_t values(100, 'hello', 100);
                    QUERY PLAN                    
--------------------------------------------------
 [Bypass]
 Insert on ed_t  (cost=0.00..0.01 rows=1 width=0)
   ->  Result  (cost=0.00..0.01 rows=1 width=0)
(3 rows)

explain format=TRaDITiONAL update ed_t set c2 = 'world' where c1 < 5;
                          QUERY PLAN                          
--------------------------------------------------------------
 Update on ed_t  (cost=0.00..13.99 rows=106 width=14)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=14)
         Filter: (c1 < 5)
(3 rows)

explain format=traditional delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

explain format='traditional' delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

explain format='TraDitional' delete from ed_t where c1 < 5;
                         QUERY PLAN                          
-------------------------------------------------------------
 Delete on ed_t  (cost=0.00..13.99 rows=106 width=6)
   ->  Seq Scan on ed_t  (cost=0.00..13.99 rows=106 width=6)
         Filter: (c1 < 5)
(3 rows)

drop table ed_t;
drop schema db_explain_desc cascade;
reset current_schema;
