drop database if exists db_default;
NOTICE:  database "db_default" does not exist, skipping
create database db_default dbcompatibility 'b';
\c db_default
create table t1(id int default 100, name varchar default 'tt');
\d t1
                      Table "public.t1"
 Column |       Type        |            Modifiers            
--------+-------------------+---------------------------------
 id     | integer           | default 100
 name   | character varying | default 'tt'::character varying

select default(name) from t1;
 mode_b_default 
----------------
(0 rows)

insert into t1 values(1,'test');
select default(id), default(name) from t1;
 mode_b_default | mode_b_default 
----------------+----------------
            100 | tt
(1 row)

create table t2(stime timestamp default current_timestamp);
\d t2
                                Table "public.t2"
 Column |            Type             |                 Modifiers                 
--------+-----------------------------+-------------------------------------------
 stime  | timestamp(0) with time zone | default b_db_statement_start_timestamp(0)

insert into t2 values(now());
select default(stime) from t2;
 mode_b_default 
----------------
 
(1 row)

select default(does_not_exist) from t2;
ERROR:  Unknown column 'does_not_exist' in 'field list'
CONTEXT:  referenced column: mode_b_default
create schema tt;
create table tt.t3(id int, stime timestamp on update current_timestamp);
\d tt.t3
                                   Table "tt.t3"
 Column |            Type             |                  Modifiers                  
--------+-----------------------------+---------------------------------------------
 id     | integer                     | 
 stime  | timestamp(0) with time zone | on update b_db_statement_start_timestamp(0)

insert into tt.t3 values(101, now());
select default(id), default(stime) from tt.t3;
 mode_b_default | mode_b_default 
----------------+----------------
                | 
(1 row)

select default(a.id) from t1 a;
 mode_b_default 
----------------
            100
(1 row)

select default(tt.t3.stime) from tt.t3;
 mode_b_default 
----------------
 
(1 row)

select default(db_default.tt.t3.id) from tt.t3;
 mode_b_default 
----------------
 
(1 row)

create table t4 (c1 INT NOT NULL AUTO_INCREMENT PRIMARY KEY, c2 VARCHAR(100), c3 VARCHAR(100));
NOTICE:  CREATE TABLE will create implicit sequence "t4_c1_seq" for serial column "t4.c1"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "t4_pkey" for table "t4"
\d t4
                     Table "public.t4"
 Column |          Type          |        Modifiers        
--------+------------------------+-------------------------
 c1     | integer                | not null AUTO_INCREMENT
 c2     | character varying(100) | 
 c3     | character varying(100) | 
Indexes:
    "t4_pkey" PRIMARY KEY, btree (c1) TABLESPACE pg_default

select default(c1) from t4;
 mode_b_default 
----------------
(0 rows)

drop table t4;
create table t5 (c1 int, c2 int, c3 int generated always as (c1-c2) stored);
insert into t5 values(1, 2);
select default(c3) from t5;
 mode_b_default 
----------------
 
(1 row)

drop table t5;
create table a(a int default 10, b int primary key);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "a_pkey" for table "a"
insert into a set a=1, b=1;
update a set a = default(b);
ERROR:  Invalid default value.
DETAIL:  the 2th column of a doesn't have a default value
CONTEXT:  referenced column: a
select default(b) from a;
ERROR:  Invalid default value.
DETAIL:  the 2th column of a doesn't have a default value
CONTEXT:  referenced column: mode_b_default
\c postgres
drop database if exists db_default;
