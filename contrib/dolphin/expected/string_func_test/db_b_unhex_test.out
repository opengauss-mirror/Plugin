create schema unhex_test;
set current_schema to 'unhex_test';
-- 非严格模式，参数不合法，报warning，返回null
set dolphin.sql_mode = 'sql_mode_full_group';
--测试字符串作为输入，返回十六进制编码的编码结果
SELECT UNHEX('6f70656e4761757373');
        unhex         
----------------------
 \x6f70656e4761757373
(1 row)

SELECT UNHEX(HEX('string'));
     unhex      
----------------
 \x737472696e67
(1 row)

SELECT HEX(UNHEX('1267'));
 hex  
------
 1267
(1 row)

SELECT UNHEX(HEX('测试'));
     unhex      
----------------
 \xe6b58be8af95
(1 row)

SELECT UNHEX('');
 unhex 
-------
 \x
(1 row)

--测试非十六进制符号和二进制类型作为输入，返回NULL
SELECT UNHEX('GG');
WARNING:  Incorrect string value: "GG" for function unhex 
CONTEXT:  referenced column: unhex
 unhex 
-------
 
(1 row)

SELECT UNHEX('4142'::bytea);
 unhex 
-------
 
(1 row)

--测试十六进制串字符数为奇数的情况，在高位补0后返回解码结果
SELECT UNHEX('941424344');
    unhex     
--------------
 \x0941424344
(1 row)

SELECT UNHEX('0941424344');
    unhex     
--------------
 \x0941424344
(1 row)

--测试numeric作为输入，返回十六进制编码的编码结果，这里是的数字是十六进制编码，若想将十六进制数转为十进制数，需使用其它函数
SELECT UNHEX('41424344454647484950515253545556575859');
                  unhex                   
------------------------------------------
 \x41424344454647484950515253545556575859
(1 row)

SELECT UNHEX(41424344454647484950515253545556575859);
                  unhex                   
------------------------------------------
 \x41424344454647484950515253545556575859
(1 row)

--测试日期类型、bool类型、空值作为输入
SELECT UNHEX('2022-12-31'::date);
WARNING:  Incorrect string value: "2022-12-31" for function unhex 
CONTEXT:  referenced column: unhex
 unhex 
-------
 
(1 row)

SELECT HEX(UNHEX(TRUE));
 hex 
-----
 01
(1 row)

SELECT HEX(UNHEX(FALSE));
 hex 
-----
 00
(1 row)

SELECT UNHEX(NULL);
 unhex 
-------
 
(1 row)

--测试表格类型作为输入
CREATE TABLE test_unhex (name text);
INSERT INTO test_unhex values('4142'), ('6f70656e4761757373');
SELECT UNHEX(name) from test_unhex;
        unhex         
----------------------
 \x4142
 \x6f70656e4761757373
(2 rows)

set bytea_output = escape;
SELECT unhex(32) ^ 3;
 ?column? 
----------
 1
(1 row)

SELECT unhex(35 + 1), unhex(33 - 1), unhex(12 * 3);
 unhex | unhex | unhex 
-------+-------+-------
 6     | 2     | 6
(1 row)

-- 严格模式，参数不合法，报error
set dolphin.sql_mode = 'sql_mode_strict';
SELECT UNHEX('GG');
WARNING:  Incorrect string value: "GG" for function unhex 
CONTEXT:  referenced column: unhex
 unhex 
-------
 
(1 row)

select +unhex(36),-unhex('43');
WARNING:  invalid input syntax for type double precision: "C"
 ?column? | ?column? 
----------+----------
        6 |       -0
(1 row)

drop schema unhex_test cascade;
NOTICE:  drop cascades to table test_unhex
reset current_schema;
