drop database if exists m_create_proc_type;
NOTICE:  database "m_create_proc_type" does not exist, skipping
create database m_create_proc_type dbcompatibility 'B';
\c m_create_proc_type
--test create procedure 
delimiter //
CREATE PROCEDURE proc1 ()
       BEGIN
         SELECT 1;
       END;
//
delimiter ;
-- test proc call
create table item(c1 int, c2 int);
create procedure procedure_1(a int, b int)
as
begin
   insert into item values(a, b);
end;
/
call procedure_1(1,2);
 procedure_1 
-------------
 
(1 row)

delimiter //
CREATE PROCEDURE procedure_1_m (c1 int, c2 int)
       BEGIN
         insert into item values(c1, c2);
       END;
//
delimiter ;
call procedure_1_m(6,9);
ERROR:  column reference "c1" is ambiguous
LINE 1: insert into item values(c1, c2)
                                ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into item values(c1, c2)
CONTEXT:  PL/pgSQL function procedure_1_m(integer,integer) line 1 at SQL statement
select * from item;
 c1 | c2 
----+----
  1 |  2
(1 row)

select procedure_1_m(6,9);
ERROR:  column reference "c1" is ambiguous
LINE 1: insert into item values(c1, c2)
                                ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into item values(c1, c2)
CONTEXT:  PL/pgSQL function procedure_1_m(integer,integer) line 1 at SQL statement
referenced column: procedure_1_m
select * from procedure_1_m(6,9);
ERROR:  column reference "c1" is ambiguous
LINE 1: insert into item values(c1, c2)
                                ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into item values(c1, c2)
CONTEXT:  PL/pgSQL function procedure_1_m(integer,integer) line 1 at SQL statement
select * from item;
 c1 | c2 
----+----
  1 |  2
(1 row)

-- test declare
create table test (a int);
CREATE PROCEDURE testpro(a int) as
declare
b int;
begin
b  := 5;
insert into test values (a + b);
end;
/
call testpro (2);
ERROR:  column reference "a" is ambiguous
LINE 1: insert into test values (a + b)
                                 ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into test values (a + b)
CONTEXT:  PL/pgSQL function testpro(integer) line 6 at SQL statement
--error
delimiter //
CREATE PROCEDURE testpro_m() 
declare
b int;
begin
b  := 5;
insert into test values (a + b);
end;
//
ERROR:  syntax error at or near "declare
b int"
LINE 2: declare
        ^
delimiter ;
--success
delimiter //
CREATE PROCEDURE testpro_m(a int)
begin
declare 
b int;
b  := 5;
insert into test values (a + b);
end;
//
delimiter ;
call testpro_m (5);
ERROR:  column reference "a" is ambiguous
LINE 1: insert into test values (a + b)
                                 ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into test values (a + b)
CONTEXT:  PL/pgSQL function testpro_m(integer) line 5 at SQL statement
select * from test;
 a 
---
(0 rows)

--testmulti declare
 delimiter //
 CREATE PROCEDURE testpro_m6(a int)
 begin
 declare b int;
 declare c int;
 b:= 9;
 insert into test values (a + b);
    begin 
    declare d int;
    insert into test values (a + b);
    end;
 end;
 //
 delimiter ;
 delimiter //
 CREATE PROCEDURE testpro_m7(a int)
 begin
 declare b int;
 declare c int;
 b := 9;
 insert into test values (a + b);
    begin 
    declare d int;
    insert into test values (a + b);
          begin
         declare e int;
         insert into test values (a + b);
         end;
         end;
 end;
 //
delimiter ;
call testpro_m6(10);
ERROR:  column reference "a" is ambiguous
LINE 1: insert into test values (a + b)
                                 ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into test values (a + b)
CONTEXT:  PL/pgSQL function testpro_m6(integer) line 4 at SQL statement
call testpro_m7(11);
ERROR:  column reference "a" is ambiguous
LINE 1: insert into test values (a + b)
                                 ^
DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
QUERY:  insert into test values (a + b)
CONTEXT:  PL/pgSQL function testpro_m7(integer) line 4 at SQL statement
select * from test;
 a 
---
(0 rows)

-- test options 
delimiter //
CREATE PROCEDURE procedure_1_m_o (c1 int, c2 int) LANGUAGE SQL
       BEGIN
         insert into item values(88,88);
       END;
//
delimiter ;
delimiter //
CREATE PROCEDURE procedure_2_m_o() NO SQL READS SQL DATA LANGUAGE SQL
       BEGIN
         insert into item values(99, 99);
       END;
//
delimiter ;
\c postgres
drop database m_create_proc_type;
