set dolphin.b_compatibility_mode to off;
drop database if exists db_b_log_test;
NOTICE:  database "db_b_log_test" does not exist, skipping
create database db_b_log_test dbcompatibility 'A';
\c db_b_log_test
SELECT LOG(10);
 log 
-----
   1
(1 row)

\c contrib_regression
set dolphin.b_compatibility_mode to off;
drop database db_b_log_test;
set dolphin.b_compatibility_mode to on;
create schema db_b_log_test;
set current_schema to 'db_b_log_test';
SELECT LOG(10);
        log        
-------------------
 2.302585092994046
(1 row)

SELECT LOG10(100);
 log10 
-------
     2
(1 row)

SELECT LOG2(64);
 log2 
------
    6
(1 row)

SELECT LOG(10::numeric);
        log         
--------------------
 2.3025850929940457
(1 row)

SELECT LOG10(100::numeric);
 log10 
-------
     2
(1 row)

SELECT LOG2(64::numeric);
 log2 
------
    6
(1 row)

SELECT LOG(0) IS NULL;
WARNING:  Invalid argument '0.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG10(0) IS NULL;
WARNING:  Invalid argument '0.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG2(0) IS NULL;
WARNING:  Invalid argument '0.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG(-1) IS NULL;
WARNING:  Invalid argument '-1.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG10(-1) IS NULL;
WARNING:  Invalid argument '-1.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG2(-1) IS NULL;
WARNING:  Invalid argument '-1.000000' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG(0::numeric) IS NULL;
WARNING:  Invalid argument '0' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG10(0::numeric) IS NULL;
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log10
SQL function "log10" statement 1
 ?column? 
----------
 t
(1 row)

SELECT LOG2(0::numeric) IS NULL;
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log2
SQL function "log2" statement 1
 ?column? 
----------
 t
(1 row)

SELECT LOG(-1::numeric) IS NULL;
WARNING:  Invalid argument '-1' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG10(-1::numeric) IS NULL;
WARNING:  Invalid argument '-1.000000' for logarithm
CONTEXT:  referenced column: log10
SQL function "log10" statement 1
 ?column? 
----------
 t
(1 row)

SELECT LOG2(-1::numeric) IS NULL;
WARNING:  Invalid argument '-1.000000' for logarithm
CONTEXT:  referenced column: log2
SQL function "log2" statement 1
 ?column? 
----------
 t
(1 row)

SELECT LOG(2, 64) IS NULL;
 ?column? 
----------
 f
(1 row)

SELECT LOG(-2, 64) IS NULL;
WARNING:  Invalid argument '-2' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG(2, -64) IS NULL;
WARNING:  Invalid argument '-64' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG(0, 64) IS NULL;
WARNING:  Invalid argument '0' for logarithm
 ?column? 
----------
 t
(1 row)

SELECT LOG(2, 0) IS NULL;
WARNING:  Invalid argument '0' for logarithm
 ?column? 
----------
 t
(1 row)

select log(111);
        log        
-------------------
 4.709530201312334
(1 row)

select log(b'111');
        log        
-------------------
 1.945910149055313
(1 row)

select log(7);
        log        
-------------------
 1.945910149055313
(1 row)

select log2(111);
       log2        
-------------------
 6.794415866350106
(1 row)

select log2(b'111');
       log2        
-------------------
 2.807354922057604
(1 row)

select log2(7);
       log2        
-------------------
 2.807354922057604
(1 row)

select log10(111);
       log10       
-------------------
 2.045322978786658
(1 row)

select log10(b'111');
       log10        
--------------------
 0.8450980400142568
(1 row)

select log10(7);
       log10        
--------------------
 0.8450980400142568
(1 row)

select log(b'111'::int);
        log        
-------------------
 1.945910149055313
(1 row)

select log2(b'111'::int);
       log2        
-------------------
 2.807354922057604
(1 row)

select log10(b'111'::int);
       log10        
--------------------
 0.8450980400142568
(1 row)

set dolphin.sql_mode = '';
create table test_type_table
(
`int1` tinyint,
`uint1` tinyint unsigned,
`int2` smallint,
`uint2` smallint unsigned,
`int4` integer,
`uint4` integer unsigned,
`int8` bigint,
`uint8` bigint unsigned,
`float4` float4,
`float8` float8,
`numeric` decimal(20, 6),
`bit1` bit(1),
`bit64` bit(64),
`boolean` boolean,
`date` date,
`time` time,
`time(4)` time(4),
`datetime` datetime,
`datetime(4)` datetime(4) default '2022-11-11 11:11:11',
`timestamp` timestamp,
`timestamp(4)` timestamp(4) default '2022-11-11 11:11:11',
`year` year,
`char` char(100),
`varchar` varchar(100),
`binary` binary(100),
`varbinary` varbinary(100),
`tinyblob` tinyblob,
`blob` blob,
`mediumblob` mediumblob,
`longblob` longblob,
`text` text,
`enum_t` enum('a', 'b', 'c'),
`set_t` set('a', 'b', 'c'),
`json` json
);
NOTICE:  CREATE TABLE will create implicit set "test_type_table_set_t_set" for column "test_type_table.set_t"
insert into test_type_table values (1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, b'1', b'111', true,
'2023-02-05', '19:10:50', '19:10:50.3456', '2023-02-05 19:10:50',
'2023-02-05 19:10:50.456', '2023-02-05 19:10:50', '2023-02-05 19:10:50.456',
'2023', '1.23a', '1.23a', '1.23a', '1.23a', '1.23a', '1.23a', '1.23a', '1.23a', '1.23a',
'a', 'a,c', json_object('a', 1, 'b', 2));
create table test_log as select  log10(`int1`) as log1, log10(`uint1`) as log2, log10(`int2`) as log3,  log10(`uint2`) as log4,  log10(`int4`) as log5, log10(`uint4`) as log6,  
log10(`int8`) as log7,  log10(`uint8`) as log8, log10(`float4`) as log9, log10(`float8`) as log10, log10(`numeric`) as log11, log10(`bit1`) as log12,  log10(`bit64`) as log13,  
log10(`boolean`) as log14, log10(`char`) as log15,  log10(`varchar`) as log16,  log10(`binary`) as log17, log10(`varbinary`) as log18, log10(`text`) as log19, log10(`numeric`) 
as log20 from test_type_table;
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log15
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log16
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log17
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log18
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log19
\d test_log
    Table "db_b_log_test.test_log"
 Column |       Type       | Modifiers 
--------+------------------+-----------
 log1   | double precision | 
 log2   | double precision | 
 log3   | double precision | 
 log4   | double precision | 
 log5   | double precision | 
 log6   | double precision | 
 log7   | double precision | 
 log8   | double precision | 
 log9   | double precision | 
 log10  | double precision | 
 log11  | double precision | 
 log12  | double precision | 
 log13  | double precision | 
 log14  | double precision | 
 log15  | double precision | 
 log16  | double precision | 
 log17  | double precision | 
 log18  | double precision | 
 log19  | double precision | 
 log20  | double precision | 

drop table if exists test_log;
create table test_log as select  log2(`int1`) as log1, log2(`uint1`) as log2, log2(`int2`) as log3,  log2(`uint2`) as log4,  log2(`int4`) as log5, log2(`uint4`) as log6,  
log2(`int8`) as log7,  log2(`uint8`) as log8, log2(`float4`) as log9, log2(`float8`) as log10, log2(`numeric`) as log11, log2(`bit1`) as log12,  log2(`bit64`) as log13,  
log2(`boolean`) as log14, log2(`char`) as log15,  log2(`varchar`) as log16,  log2(`binary`) as log17, log2(`varbinary`) as log18, log2(`text`) as log19, log2(`numeric`) 
as log20 from test_type_table;
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log15
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log16
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log17
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log18
WARNING:  invalid input syntax for type double precision: "1.23a"
CONTEXT:  referenced column: log19
\d test_log
    Table "db_b_log_test.test_log"
 Column |       Type       | Modifiers 
--------+------------------+-----------
 log1   | double precision | 
 log2   | double precision | 
 log3   | double precision | 
 log4   | double precision | 
 log5   | double precision | 
 log6   | double precision | 
 log7   | double precision | 
 log8   | double precision | 
 log9   | double precision | 
 log10  | double precision | 
 log11  | double precision | 
 log12  | double precision | 
 log13  | double precision | 
 log14  | double precision | 
 log15  | double precision | 
 log16  | double precision | 
 log17  | double precision | 
 log18  | double precision | 
 log19  | double precision | 
 log20  | double precision | 

drop table if exists test_log;
drop table if exists test_type_table;
reset dolphin.sql_mode;
create table test_log(val double);
insert into test_log select log10(0);
ERROR:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log10
insert into test_log select log10(-10);
ERROR:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log10
insert into test_log select log2(0);
ERROR:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log2
insert into test_log select log2(-10);
ERROR:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log2
insert ignore into test_log select log10(0);
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log10
insert ignore into test_log select log10(-10);
WARNING:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log10
insert ignore into test_log select log2(0);
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log2
insert ignore into test_log select log2(-10);
WARNING:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log2
set dolphin.sql_mode = '';
insert into test_log select log10(0);
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log10
insert into test_log select log10(-10);
WARNING:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log10
insert into test_log select log2(0);
WARNING:  Invalid argument '0.000000' for logarithm
CONTEXT:  referenced column: log2
insert into test_log select log2(-10);
WARNING:  Invalid argument '-10.000000' for logarithm
CONTEXT:  referenced column: log2
select * from test_log;
 val 
-----
    
    
    
    
    
    
    
    
(8 rows)

reset dolphin.sql_mode;
drop table if exists test_log;
drop schema db_b_log_test cascade;
reset current_schema;
