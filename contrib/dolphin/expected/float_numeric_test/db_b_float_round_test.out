-- the test case of A format
drop database if exists test;
NOTICE:  DROP DATABASE will change to DROP SCHEMA when dolphin.b_compatibility_mode is on.
NOTICE:  schema "test" does not exist, skipping
create database test dbcompatibility 'A';
\c test
SELECT 2.5::float4::int1;
 int1 
------
 2
(1 row)

SELECT 2.5::float8::int1;
 int1 
------
 2
(1 row)

SELECT 2.5::int1;
 int1 
------
 3
(1 row)

SELECT 2.5::float4::int2;
 int2 
------
    2
(1 row)

SELECT 2.5::float8::int2;
 int2 
------
    2
(1 row)

SELECT 2.5::int2;
 int2 
------
    3
(1 row)

SELECT 2.5::float4::int4;
 int4 
------
    2
(1 row)

SELECT 2.5::float8::int4;
 int4 
------
    2
(1 row)

SELECT 2.5::int4;
 int4 
------
    3
(1 row)

SELECT 2.5::float4::int8;
 int8 
------
    2
(1 row)

SELECT 2.5::float8::int8;
 int8 
------
    2
(1 row)

SELECT 2.5::int8;
 int8 
------
    3
(1 row)

SELECT 3.5::float4::int1;
 int1 
------
 3
(1 row)

SELECT 3.5::float8::int1;
 int1 
------
 3
(1 row)

SELECT 3.5::int1;
 int1 
------
 4
(1 row)

SELECT 3.5::float4::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::float8::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::float4::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::float8::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::float4::int8;
 int8 
------
    4
(1 row)

SELECT 3.5::float8::int8;
 int8 
------
    4
(1 row)

SELECT 3.5::int8;
 int8 
------
    4
(1 row)

SELECT dround(2.5);
 dround 
--------
      2
(1 row)

SELECT dround(3.5);
 dround 
--------
      4
(1 row)

\c contrib_regression
drop database test;
NOTICE:  DROP DATABASE will change to DROP SCHEMA when dolphin.b_compatibility_mode is on.
ERROR:  schema "test" does not exist
-- the test case of dolphin plugin
create schema test;
set current_schema to 'test';
SELECT 2.5::float4::int1;
 int1 
------
 3
(1 row)

SELECT 2.5::float8::int1;
 int1 
------
 3
(1 row)

SELECT 2.5::int1;
 int1 
------
 3
(1 row)

SELECT 2.5::float4::int2;
 int2 
------
    3
(1 row)

SELECT 2.5::float8::int2;
 int2 
------
    3
(1 row)

SELECT 2.5::int2;
 int2 
------
    3
(1 row)

SELECT 2.5::float4::int4;
 int4 
------
    3
(1 row)

SELECT 2.5::float8::int4;
 int4 
------
    3
(1 row)

SELECT 2.5::int4;
 int4 
------
    3
(1 row)

SELECT 2.5::float4::int8;
 int8 
------
    3
(1 row)

SELECT 2.5::float8::int8;
 int8 
------
    3
(1 row)

SELECT 2.5::int8;
 int8 
------
    3
(1 row)

SELECT 3.5::float4::int1;
 int1 
------
 4
(1 row)

SELECT 3.5::float8::int1;
 int1 
------
 4
(1 row)

SELECT 3.5::int1;
 int1 
------
 4
(1 row)

SELECT 3.5::float4::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::float8::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::int2;
 int2 
------
    4
(1 row)

SELECT 3.5::float4::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::float8::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::int4;
 int4 
------
    4
(1 row)

SELECT 3.5::float4::int8;
 int8 
------
    4
(1 row)

SELECT 3.5::float8::int8;
 int8 
------
    4
(1 row)

SELECT 3.5::int8;
 int8 
------
    4
(1 row)

SELECT dround(2.5);
 dround 
--------
      2
(1 row)

SELECT dround(3.5);
 dround 
--------
      4
(1 row)

set dolphin.sql_mode = '';
create table test_type_table_round
(
   `float4` float4,
   `float8` float8,
   `numeric` decimal(20, 6),
   `time(4)` time(4),
   `datetime(4)` datetime(4) default '2022-11-11 11:11:11',
   `timestamp(4)` timestamp(4) default '2022-11-11 11:11:11',
   `char` char(100),
   `varchar` varchar(100), 
   `binary` binary(100),
   `varbinary` varbinary(100),
   `tinyblob` tinyblob,
   `blob` blob,
   `mediumblob` mediumblob,
   `longblob` longblob,
   `text` text,
   `enum_t` enum('2.5', '3.5', '-2.5','-3.5'),
   `set_t` set('2.5', '3.5', '-2.5', '-3.5')
);
NOTICE:  CREATE TABLE will create implicit set "test_type_table_round_set_t_set" for column "test_type_table_round.set_t"
insert into test_type_table_round values (2.5, 2.5, 2.5, '19:10:52.5', '2023-02-05 19:10:52.5', '2023-02-05 19:10:52.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5', '2.5');
insert into test_type_table_round values (-2.5, -2.5, -2.5, '19:10:52.5', '2023-02-05 19:10:52.5', '2023-02-05 19:10:52.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5', '-2.5');
insert into test_type_table_round values (3.5, 3.5, 3.5, '19:10:53.5', '2023-02-05 19:10:53.5', '2023-02-05 19:10:53.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5', '3.5');
insert into test_type_table_round values (-3.5, -3.5, -3.5, '19:10:53.5', '2023-02-05 19:10:53.5', '2023-02-05 19:10:53.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5', '-3.5');
create table test_round1 as select round(`float4`) as round1, round(`float8`) as round2, round(`numeric`) as round3, round(`time(4)`) as round4, round(`datetime(4)`) as round5, round(`timestamp(4)`) as round6, round(`char`) as round7, round(`varchar`) as round8, round(`binary`) as round9,round(`varbinary`) as round10, round(`tinyblob`) as round11, round(`blob`) as round12, round(`mediumblob`) as round13, round(`longblob`) as round14, round(`text`) as round15, round(`enum_t`) as round16, round(`set_t`) as round17 from test_type_table_round;
select * from test_round1;
 round1 | round2 | round3 | round4 |     round5     |     round6     | round7 | round8 | round9 | round10 | round11 | round12 | round13 | round14 | round15 | round16 | round17 
--------+--------+--------+--------+----------------+----------------+--------+--------+--------+---------+---------+---------+---------+---------+---------+---------+---------
      2 |      2 |      3 | 191052 | 20230205191052 | 20230205191052 |      2 |      2 |      2 |       2 |       2 |       2 |       2 |       2 |       2 |       1 |       1
     -2 |     -2 |     -3 | 191052 | 20230205191052 | 20230205191052 |     -2 |     -2 |     -2 |      -2 |      -2 |      -2 |      -2 |      -2 |      -2 |       3 |       4
      4 |      4 |      4 | 191054 | 20230205191054 | 20230205191054 |      4 |      4 |      4 |       4 |       4 |       4 |       4 |       4 |       4 |       2 |       2
     -4 |     -4 |     -4 | 191054 | 20230205191054 | 20230205191054 |     -4 |     -4 |     -4 |      -4 |      -4 |      -4 |      -4 |      -4 |      -4 |       4 |       8
(4 rows)

show create table test_round1;
    Table    |              Create Table               
-------------+-----------------------------------------
 test_round1 | SET search_path = test;                +
             | CREATE TABLE test_round1 (             +
             |     round1 double precision,           +
             |     round2 double precision,           +
             |     round3 number,                     +
             |     round4 double precision,           +
             |     round5 double precision,           +
             |     round6 double precision,           +
             |     round7 double precision,           +
             |     round8 double precision,           +
             |     round9 double precision,           +
             |     round10 double precision,          +
             |     round11 double precision,          +
             |     round12 double precision,          +
             |     round13 double precision,          +
             |     round14 double precision,          +
             |     round15 double precision,          +
             |     round16 double precision,          +
             |     round17 double precision           +
             | )                                      +
             | WITH (orientation=row, compression=no);
(1 row)

drop table test_round1;
drop table test_type_table_round;
drop schema test cascade;
reset current_schema;
