---- b compatibility case
drop database if exists b_datetime_func_test;
NOTICE:  database "b_datetime_func_test" does not exist, skipping
create database b_datetime_func_test dbcompatibility 'b';
\c b_datetime_func_test
set datestyle = 'ISO,ymd';
set time zone "Asia/Shanghai";
-- test get_format
select get_format(DATE, 'EUR');
 get_format 
------------
 %d.%m.%Y
(1 row)

select get_format(DATE, 'USA');
 get_format 
------------
 %m.%d.%Y
(1 row)

select get_format(DATE, 'JIS');
 get_format 
------------
 %Y-%m-%d
(1 row)

select get_format(DATE, 'ISO');
 get_format 
------------
 %Y-%m-%d
(1 row)

select get_format(DATE, 'INTERNAL');
 get_format 
------------
 %Y%m%d
(1 row)

select get_format(DATETIME, 'EUR');
    get_format     
-------------------
 %Y-%m-%d %H.%i.%s
(1 row)

select get_format(DATETIME, 'USA');
    get_format     
-------------------
 %Y-%m-%d %H.%i.%s
(1 row)

select get_format(DATETIME, 'JIS');
    get_format     
-------------------
 %Y-%m-%d %H:%i:%s
(1 row)

select get_format(DATETIME, 'ISO');
    get_format     
-------------------
 %Y-%m-%d %H:%i:%s
(1 row)

select get_format(DATETIME, 'INTERNAL');
  get_format  
--------------
 %Y%m%d%H%i%s
(1 row)

select get_format(TIME, 'EUR');
 get_format 
------------
 %H.%i.%s
(1 row)

select get_format(TIME, 'USA');
 get_format  
-------------
 %h:%i:%s %p
(1 row)

select get_format(TIME, 'JIS');
 get_format 
------------
 %H:%i:%s
(1 row)

select get_format(TIME, 'ISO');
 get_format 
------------
 %H:%i:%s
(1 row)

select get_format(TIME, 'INTERNAL');
 get_format 
------------
 %H%i%s
(1 row)

select get_format(DATE, 'abc');
 get_format 
------------
 
(1 row)

select get_format(abc, 'EUR');
ERROR:  syntax error at or near "abc"
LINE 1: select get_format(abc, 'EUR');
                          ^
-- test extract
set b_compatibility_mode = true;
-- 严格模式
set sql_mode = 'sql_mode_strict,sql_mode_full_group,pipes_as_concat';
-- 单unit
select extract(YEAR FROM '2019-07-02');
 extract 
---------
    2019
(1 row)

select extract(MONTH FROM '2019-07-02');
 extract 
---------
       7
(1 row)

select extract(WEEK FROM '2019-07-02');
 extract 
---------
      26
(1 row)

select extract(QUARTER FROM '2019-07-02');
 extract 
---------
       3
(1 row)

select extract(DAY FROM '2019-07-02');
 extract 
---------
       2
(1 row)

select extract(SECOND FROM '2019-07-02 12:12:12');
 extract 
---------
      12
(1 row)

select extract(MINUTE FROM '2019-07-02 12:12:12');
 extract 
---------
      12
(1 row)

select extract(HOUR FROM '2019-07-02 12:12:12');
 extract 
---------
      12
(1 row)

select extract(MICROSECOND FROM '2019-07-02 12:12:12.12121');
 extract 
---------
  121210
(1 row)

select extract(SECOND FROM '12:12:12');
 extract 
---------
      12
(1 row)

select extract(MINUTE FROM '12:12:12');
 extract 
---------
      12
(1 row)

select extract(HOUR FROM '12:12:12');
 extract 
---------
      12
(1 row)

select extract(MICROSECOND FROM '12:12:12.12121');
 extract 
---------
  121210
(1 row)

select extract(hour from '838:59:59');
 extract 
---------
     838
(1 row)

select extract(hour from '-838:59:59');
 extract 
---------
    -838
(1 row)

-- 混合unit
select extract(YEAR_MONTH FROM '2019-07-02');
 extract 
---------
  201907
(1 row)

select extract(DAY_MINUTE FROM '2019-07-02 12:12:12');
 extract 
---------
   21212
(1 row)

select extract(DAY_HOUR FROM '2019-07-02 12:12:12');
 extract 
---------
     212
(1 row)

select extract(DAY_MINUTE FROM '2019-07-02 12:12:12');
 extract 
---------
   21212
(1 row)

select extract(DAY_MICROSECOND FROM '2019-07-02 12:12:12.12121');
    extract    
---------------
 2121212121210
(1 row)

select extract(SECOND_MICROSECOND FROM '2019-07-02 12:12:12.12121');
 extract  
----------
 12121210
(1 row)

select extract(SECOND_MICROSECOND FROM '12:12:12.12121');
 extract  
----------
 12121210
(1 row)

select extract(MINUTE_MICROSECOND FROM '2019-07-02 12:12:12.12121');
  extract   
------------
 1212121210
(1 row)

select extract(MINUTE_MICROSECOND FROM '12:12:12.12121');
  extract   
------------
 1212121210
(1 row)

select extract(MINUTE_SECOND FROM '2019-07-02 12:12:12.12121');
 extract 
---------
    1212
(1 row)

select extract(MINUTE_SECOND FROM '12:12:12.12121');
 extract 
---------
    1212
(1 row)

select extract(HOUR_SECOND FROM '2019-07-02 12:12:12.12121');
 extract 
---------
  121212
(1 row)

select extract(HOUR_SECOND FROM '12:12:12.12121');
 extract 
---------
  121212
(1 row)

select extract(HOUR_MINUTE FROM '2019-07-02 12:12:12.12121');
 extract 
---------
    1212
(1 row)

select extract(HOUR_MINUTE FROM '12:12:12.12121');
 extract 
---------
    1212
(1 row)

select extract(HOUR_MICROSECOND FROM '2019-07-02 12:12:12.12121');
   extract    
--------------
 121212121210
(1 row)

select extract(HOUR_MICROSECOND FROM '12:12:12.12121');
   extract    
--------------
 121212121210
(1 row)

-- 边界值，坏值
select extract(aaa FROM '2019-07-02');
ERROR:  units "aaa" not supported
CONTEXT:  referenced column: extract
select extract(DAY FROM '0000-00-00');
ERROR:  Incorrect datetime value: "0000-00-00"
CONTEXT:  referenced column: extract
select extract(DAY FROM '2001-01-45');
ERROR:  date/time field value out of range: "2001-01-45"
HINT:  Perhaps you need a different "datestyle" setting.
CONTEXT:  referenced column: extract
select extract(YEAR FROM '9999-01-01');
 extract 
---------
    9999
(1 row)

select extract(YEAR FROM '10000-01-01');
ERROR:  Incorrect datetime value: "10000-01-01"
CONTEXT:  referenced column: extract
select extract(hour from '838:59:59.1');
ERROR:  date/time field value out of range: "838:59:59.1"
CONTEXT:  referenced column: extract
select extract(hour from '839:00:00');
ERROR:  date/time field value out of range: "839:00:00"
CONTEXT:  referenced column: extract
select extract(hour from '-838:59:59.1');
ERROR:  date/time field value out of range: "-838:59:59.1"
CONTEXT:  referenced column: extract
select extract(hour from '-839:00:00');
ERROR:  date/time field value out of range: "-839:00:00"
CONTEXT:  referenced column: extract
select extract(hour from '40 1:1:0');
ERROR:  date/time field value out of range: "40 1:1:0"
CONTEXT:  referenced column: extract
select extract(hour from '-40 1:1:0');
ERROR:  date/time field value out of range: "-40 1:1:0"
CONTEXT:  referenced column: extract
-- 非严格模式
set sql_mode = 'sql_mode_full_group,pipes_as_concat';
-- 单unit
select extract(hour from '838:59:59');
 extract 
---------
     838
(1 row)

select extract(hour from '-838:59:59');
 extract 
---------
    -838
(1 row)

-- 边界值，坏值
select extract(aaa FROM '2019-07-02');
ERROR:  units "aaa" not supported
CONTEXT:  referenced column: extract
select extract(DAY FROM '0000-00-00');
WARNING:  Incorrect datetime value: "0000-00-00"
CONTEXT:  referenced column: extract
 extract 
---------
        
(1 row)

select extract(DAY FROM '2001-01-45');
WARNING:  date/time field value out of range: "2001-01-45"
CONTEXT:  referenced column: extract
 extract 
---------
        
(1 row)

select extract(YEAR FROM '9999-01-01');
 extract 
---------
    9999
(1 row)

select extract(YEAR FROM '10000-01-01');
WARNING:  Incorrect datetime value: "10000-01-01"
CONTEXT:  referenced column: extract
 extract 
---------
        
(1 row)

select extract(hour from '838:59:59.1');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
     838
(1 row)

select extract(hour from '839:00:00');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
     838
(1 row)

select extract(hour from '-838:59:59.1');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
    -838
(1 row)

select extract(hour from '-839:00:00');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
    -838
(1 row)

select extract(hour from '40 1:1:0');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
     838
(1 row)

select extract(hour from '-40 1:1:0');
WARNING:  Truncated incorrect time value.
CONTEXT:  referenced column: extract
 extract 
---------
    -838
(1 row)

-- extract 结束
set b_compatibility_mode = false;
-- test date_format
-- 严格模式
set sql_mode = 'sql_mode_strict,sql_mode_full_group,pipes_as_concat';
-- format的各种情况
select date_format('2001-01-01 12:12:12','%a');
 date_format 
-------------
 Mon
(1 row)

select date_format('2001-01-01 12:12:12','%b');
 date_format 
-------------
 Jan
(1 row)

select date_format('2001-01-01 12:12:12','%c');
 date_format 
-------------
 1
(1 row)

select date_format('2001-01-01 12:12:12','%D');
 date_format 
-------------
 1st
(1 row)

select date_format('2001-01-01 12:12:12','%d');
 date_format 
-------------
 01
(1 row)

select date_format('2001-01-01 12:12:12','%e');
 date_format 
-------------
 1
(1 row)

select date_format('2001-01-01 12:12:12','%f');
 date_format 
-------------
 000000
(1 row)

select date_format('2001-01-01 12:12:12','%H');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%h');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%I');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%i');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%j');
 date_format 
-------------
 001
(1 row)

select date_format('2001-01-01 12:12:12','%k');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%l');
 date_format 
-------------
 l
(1 row)

select date_format('2001-01-01 12:12:12','%M');
 date_format 
-------------
 January
(1 row)

select date_format('2001-01-01 12:12:12','%m');
 date_format 
-------------
 01
(1 row)

select date_format('2001-01-01 12:12:12','%p');
 date_format 
-------------
 PM
(1 row)

select date_format('2001-01-01 12:12:12','%r');
 date_format 
-------------
 12:12:12 PM
(1 row)

select date_format('2001-01-01 12:12:12','%S');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%s');
 date_format 
-------------
 12
(1 row)

select date_format('2001-01-01 12:12:12','%T');
 date_format 
-------------
 12:12:12
(1 row)

select date_format('2001-01-01 12:12:12','%U');
 date_format 
-------------
 00
(1 row)

select date_format('2001-01-01 12:12:12','%u');
 date_format 
-------------
 01
(1 row)

select date_format('2001-01-01 12:12:12','%V');
 date_format 
-------------
 53
(1 row)

select date_format('2001-01-01 12:12:12','%v');
 date_format 
-------------
 01
(1 row)

select date_format('2001-01-01 12:12:12','%W');
 date_format 
-------------
 Monday
(1 row)

select date_format('2001-01-01 12:12:12','%w');
 date_format 
-------------
 1
(1 row)

select date_format('2001-01-01 12:12:12','%X');
 date_format 
-------------
 2000
(1 row)

select date_format('2001-01-01 12:12:12','%x');
 date_format 
-------------
 2001
(1 row)

select date_format('2001-01-01 12:12:12','%Y');
 date_format 
-------------
 2001
(1 row)

select date_format('2001-01-01 12:12:12','%y');
 date_format 
-------------
 01
(1 row)

select date_format('2001-01-01 12:12:12','aaaa');
 date_format 
-------------
 aaaa
(1 row)

select date_format('2001-01-01 12:12:12','%dffff');
 date_format 
-------------
 01ffff
(1 row)

select date_format('2001-01-01 12:12:12.34567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890','%b');
 date_format 
-------------
 Jan
(1 row)

select date_format('2001-01-01 12:12:12','%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b%b');
                                                                                                                                                                         date_format                                                                                                                                                                          
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 JanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJanJan
(1 row)

-- format参数存在组合
select date_format('2001-01-01 12:12:12','%Y %M %D %U');
     date_format     
---------------------
 2001 January 1st 00
(1 row)

select date_format('2001-01-01 12:12:12','%H %k %I %r %T %S %w');
            date_format             
------------------------------------
 12 12 12 12:12:12 PM 12:12:12 12 1
(1 row)

-- 边界值，坏值
select date_format('0000-00-00','%Y');
ERROR:  Incorrect datetime value: "0000-00-00"
CONTEXT:  referenced column: date_format
select date_format('2001-01-9999','%Y');
ERROR:  date/time field value out of range: "2001-01-9999"
HINT:  Perhaps you need a different "datestyle" setting.
CONTEXT:  referenced column: date_format
select date_format('2001-00-09','%Y');
 date_format 
-------------
 2001
(1 row)

select date_format('2001-15-09','%Y');
ERROR:  date/time field value out of range: "2001-15-09"
HINT:  Perhaps you need a different "datestyle" setting.
CONTEXT:  referenced column: date_format
select date_format('9999-00-09','%Y');
 date_format 
-------------
 9999
(1 row)

select date_format('10000-00-09','%Y');
ERROR:  Incorrect datetime value: "10000-00-09"
CONTEXT:  referenced column: date_format
-- 不同类型输入
select date_format(date'2001-01-09','%Y');
 date_format 
-------------
 2001
(1 row)

select date_format(datetime'2001-01-09 12:12:12','%Y');
 date_format 
-------------
 2001
(1 row)

select date_format(20010101,'%Y');
 date_format 
-------------
 2001
(1 row)

-- 非严格模式
set sql_mode = 'sql_mode_full_group,pipes_as_concat';
-- 边界值，坏值
select date_format('0000-00-00','%Y');
WARNING:  Incorrect datetime value: "0000-00-00"
CONTEXT:  referenced column: date_format
 date_format 
-------------
 
(1 row)

select date_format('2001-01-9999','%Y');
WARNING:  date/time field value out of range: "2001-01-9999"
CONTEXT:  referenced column: date_format
 date_format 
-------------
 
(1 row)

select date_format('2001-00-09','%Y');
 date_format 
-------------
 2001
(1 row)

select date_format('2001-15-09','%Y');
WARNING:  date/time field value out of range: "2001-15-09"
CONTEXT:  referenced column: date_format
 date_format 
-------------
 
(1 row)

select date_format('9999-00-09','%Y');
 date_format 
-------------
 9999
(1 row)

select date_format('10000-00-09','%Y');
WARNING:  Incorrect datetime value: "10000-00-09"
CONTEXT:  referenced column: date_format
 date_format 
-------------
 
(1 row)

-- date_format 结束
-- test from_unixtime
-- 单参数
select from_unixtime(0);
    from_unixtime    
---------------------
 1970-01-01 08:00:00
(1 row)

select from_unixtime(1);
    from_unixtime    
---------------------
 1970-01-01 08:00:01
(1 row)

select from_unixtime(1.999999);
       from_unixtime        
----------------------------
 1970-01-01 08:00:01.999999
(1 row)

select from_unixtime(1.9999995);
    from_unixtime    
---------------------
 1970-01-01 08:00:02
(1 row)

select from_unixtime(1454545444);
    from_unixtime    
---------------------
 2016-02-04 08:24:04
(1 row)

-- 双参数
select from_unixtime(0,'%Y-%m-%d %T');
    from_unixtime    
---------------------
 1970-01-01 08:00:00
(1 row)

select from_unixtime(1.999999,'%Y-%m-%d %T.%f');
       from_unixtime        
----------------------------
 1970-01-01 08:00:01.999999
(1 row)

select from_unixtime(1454545444,'%Y %M %D');
   from_unixtime   
-------------------
 2016 February 4th
(1 row)

-- 边界值，坏值
select from_unixtime(-1);
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(-1454545444);
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(-1,'%Y');
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(-1454545444,'%Y %M %D');
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(11111111111111111,'%Y %M %D');
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(11111111111111111);
 from_unixtime 
---------------
 
(1 row)

select from_unixtime(2147483647);
    from_unixtime    
---------------------
 2038-01-19 11:14:07
(1 row)

select from_unixtime(2147483647,'%Y');
 from_unixtime 
---------------
 2038
(1 row)

select from_unixtime(2147483648);
 from_unixtime 
---------------
 
(1 row)

-- test str_to_date
-- 严格模式
set sql_mode = 'sql_mode_strict,sql_mode_full_group,pipes_as_concat';
-- 正常值
select str_to_date('01,5,2013','%d,%m,%Y');
 str_to_date 
-------------
 2013-05-01
(1 row)

select str_to_date('May 1, 2013','%M %d,%Y');
 str_to_date 
-------------
 2013-05-01
(1 row)

select str_to_date('a09:30:17','a%h:%i:%s');
 str_to_date 
-------------
 09:30:17
(1 row)

select str_to_date('a09:30:17','%h:%i:%s');
ERROR:  Incorrect time value: 'a09:30:17' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('09:30:17','%h:%i:%s');
 str_to_date 
-------------
 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %H:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %h:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %I:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %k:%i:%S');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %l:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date('abc','abc');
ERROR:  Incorrect date value: 'abc' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('9','%m');
ERROR:  Incorrect date value: '9' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('9','%s');
 str_to_date 
-------------
 00:00:09
(1 row)

select str_to_date('00/00/0000', '%m/%d/%Y');
ERROR:  Incorrect date value: '00/00/0000' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('04/31/2004', '%m/%d/%Y');
ERROR:  Incorrect date value: '04/31/2004' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('2022,12,12','%Y,%m,%D');
 str_to_date 
-------------
 2022-12-12
(1 row)

select str_to_date('2022,January,12','%Y,%M,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('22,January,12','%y,%M,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,Jan,12','%Y,%M,%d');
ERROR:  Incorrect date value: '2022,Jan,12' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('2022,1,12','%Y,%c,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,1,12','%Y,%c,%e');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,1,12 12112','%Y,%c,%e %f');
        str_to_date        
---------------------------
 2022-01-12 00:00:00.12112
(1 row)

select str_to_date('2022,345', '%Y,%j');
 str_to_date 
-------------
 2022-12-11
(1 row)

select str_to_date('2001-01-01 12:1:12 PM','%Y-%m-%D %r');
     str_to_date     
---------------------
 2001-01-01 14:01:12
(1 row)

select str_to_date('2001-01-01 12:1:12 PM','%Y-%m-%D %T');
ERROR:  Truncated incorrect datetime value: '2001-01-01 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,00,Sun 12:1:12 PM','%Y,%U,%a %T');
ERROR:  Truncated incorrect datetime value: '2001,00,Sun 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,00,Sun 12:1:12 PM','%Y,%u,%a %T');
ERROR:  Truncated incorrect datetime value: '2001,00,Sun 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,05,Sat 12:1:12 PM','%Y,%V,%a %T');
ERROR:  Truncated incorrect datetime value: '2001,05,Sat 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,05,Sat 12:1:12 PM','%Y,%v,%a %T');
ERROR:  Truncated incorrect datetime value: '2001,05,Sat 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,01,Sunday 12:1:12 PM','%Y,%U,%W %T');
ERROR:  Truncated incorrect datetime value: '2001,01,Sunday 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,01,1 12:1:12 PM','%Y,%U,%w %T');
ERROR:  Truncated incorrect datetime value: '2001,01,1 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,01,01','%Y,%X,%V');
ERROR:  Incorrect date value: '2001,01,01' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('2001,01,01','%Y,%x,%v');
ERROR:  Incorrect date value: '2001,01,01' for function str_to_date
CONTEXT:  referenced column: str_to_date
SELECT str_to_date('200442 Monday', '%X%V %W');
 str_to_date 
-------------
 2004-10-18
(1 row)

-- 边界值，坏值
select str_to_date(null, '%Y');
 str_to_date 
-------------
 
(1 row)

select str_to_date('2021-11-12', null);
ERROR:  Incorrect datetime value: '2021-11-12' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('01,5,9999','%d,%m,%Y');
 str_to_date 
-------------
 9999-05-01
(1 row)

select str_to_date('22,January,Sun','%y,%M,%a');
ERROR:  Incorrect date value: '22,January,Sun' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('01,5,10000','%d,%m,%Y');
ERROR:  Truncated incorrect date value: '01,5,10000'
CONTEXT:  referenced column: str_to_date
select str_to_date('01,5,9999','%d,%m%Y');
ERROR:  Incorrect date value: '01,5,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('015,9999','%d,%m,%Y');
ERROR:  Incorrect date value: '015,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('00,5,9999','%d,%m,%Y');
ERROR:  Incorrect date value: '00,5,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('01,0,9999','%d,%m,%Y');
ERROR:  Incorrect date value: '01,0,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
select str_to_date('01,111,9999','%d,%m,%Y');
ERROR:  Incorrect date value: '01,111,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
SELECT STR_TO_DATE('200454 Monday', '%X%V %W');
ERROR:  Incorrect date value: '200454 Monday' for function str_to_date
CONTEXT:  referenced column: str_to_date
-- 非严格模式
set sql_mode = 'sql_mode_full_group,pipes_as_concat';
-- 正常值
select str_to_date('01,5,2013','%d,%m,%Y');
 str_to_date 
-------------
 2013-05-01
(1 row)

select str_to_date('May 1, 2013','%M %d,%Y');
 str_to_date 
-------------
 2013-05-01
(1 row)

select str_to_date('a09:30:17','a%h:%i:%s');
 str_to_date 
-------------
 09:30:17
(1 row)

select str_to_date('a09:30:17','%h:%i:%s');
WARNING:  Incorrect time value: 'a09:30:17' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('09:30:17','%h:%i:%s');
 str_to_date 
-------------
 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %H:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %h:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %I:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %k:%i:%S');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date(' 2001,01,01 09:30:17','%Y,%m,%D %l:%i:%s');
     str_to_date     
---------------------
 2001-01-01 09:30:17
(1 row)

select str_to_date('abc','abc');
WARNING:  Incorrect date value: 'abc' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('9','%m');
WARNING:  Incorrect date value: '9' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('9','%s');
 str_to_date 
-------------
 00:00:09
(1 row)

select str_to_date('00/00/0000', '%m/%d/%Y');
WARNING:  Incorrect date value: '00/00/0000' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('04/31/2004', '%m/%d/%Y');
WARNING:  Incorrect date value: '04/31/2004' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('2022,12,12','%Y,%m,%D');
 str_to_date 
-------------
 2022-12-12
(1 row)

select str_to_date('2022,January,12','%Y,%M,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('22,January,12','%y,%M,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,Jan,12','%Y,%M,%d');
WARNING:  Incorrect date value: '2022,Jan,12' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('2022,1,12','%Y,%c,%d');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,1,12','%Y,%c,%e');
 str_to_date 
-------------
 2022-01-12
(1 row)

select str_to_date('2022,1,12 12112','%Y,%c,%e %f');
        str_to_date        
---------------------------
 2022-01-12 00:00:00.12112
(1 row)

select str_to_date('2022,345', '%Y,%j');
 str_to_date 
-------------
 2022-12-11
(1 row)

select str_to_date('2001-01-01 12:1:12 PM','%Y-%m-%D %r');
     str_to_date     
---------------------
 2001-01-01 14:01:12
(1 row)

select str_to_date('2001-01-01 12:1:12 PM','%Y-%m-%D %T');
WARNING:  Truncated incorrect datetime value: '2001-01-01 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
     str_to_date     
---------------------
 2001-01-01 02:01:12
(1 row)

select str_to_date('2001,00,Sun 12:1:12 PM','%Y,%U,%a %T');
WARNING:  Truncated incorrect datetime value: '2001,00,Sun 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
     str_to_date     
---------------------
 2000-12-31 12:01:12
(1 row)

select str_to_date('2001,00,Sun 12:1:12 PM','%Y,%u,%a %T');
WARNING:  Truncated incorrect datetime value: '2001,00,Sun 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
     str_to_date     
---------------------
 2000-12-31 12:01:12
(1 row)

select str_to_date('2001,05,Sat 12:1:12 PM','%Y,%V,%a %T');
WARNING:  Truncated incorrect datetime value: '2001,05,Sat 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
WARNING:  Incorrect datetime value: '2001,05,Sat 12:1:12 PM' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('2001,05,Sat 12:1:12 PM','%Y,%v,%a %T');
WARNING:  Truncated incorrect datetime value: '2001,05,Sat 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
WARNING:  Incorrect datetime value: '2001,05,Sat 12:1:12 PM' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('2001,01,Sunday 12:1:12 PM','%Y,%U,%W %T');
WARNING:  Truncated incorrect datetime value: '2001,01,Sunday 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
     str_to_date     
---------------------
 2001-01-07 12:01:12
(1 row)

select str_to_date('2001,01,1 12:1:12 PM','%Y,%U,%w %T');
WARNING:  Truncated incorrect datetime value: '2001,01,1 12:1:12 PM'
CONTEXT:  referenced column: str_to_date
     str_to_date     
---------------------
 2001-01-08 12:01:12
(1 row)

select str_to_date('2001,01,01','%Y,%X,%V');
WARNING:  Incorrect date value: '2001,01,01' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('2001,01,01','%Y,%x,%v');
WARNING:  Incorrect date value: '2001,01,01' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

SELECT STR_TO_DATE('200442 Monday', '%X%V %W');
 str_to_date 
-------------
 2004-10-18
(1 row)

SELECT STR_TO_DATE('200442 Monday', '%x%v %W');
 str_to_date 
-------------
 2004-10-11
(1 row)

-- 边界值，坏值
select str_to_date(null, '%Y');
 str_to_date 
-------------
 
(1 row)

select str_to_date('2021-11-12', null);
WARNING:  Incorrect datetime value: '2021-11-12' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('01,5,9999','%d,%m,%Y');
 str_to_date 
-------------
 9999-05-01
(1 row)

select str_to_date('22,January,Sun','%y,%M,%a');
WARNING:  Incorrect date value: '22,January,Sun' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('01,5,10000','%d,%m,%Y');
WARNING:  Truncated incorrect date value: '01,5,10000'
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 1000-05-01
(1 row)

select str_to_date('01,5,9999','%d,%m%Y');
WARNING:  Incorrect date value: '01,5,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('015,9999','%d,%m,%Y');
WARNING:  Incorrect date value: '015,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('00,5,9999','%d,%m,%Y');
WARNING:  Incorrect date value: '00,5,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('01,0,9999','%d,%m,%Y');
WARNING:  Incorrect date value: '01,0,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

select str_to_date('01,111,9999','%d,%m,%Y');
WARNING:  Incorrect date value: '01,111,9999' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

SELECT STR_TO_DATE('200454 Monday', '%X%V %W');
WARNING:  Incorrect date value: '200454 Monday' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

SELECT STR_TO_DATE('200454 Monday', '%x%v %W');
WARNING:  Incorrect date value: '200454 Monday' for function str_to_date
CONTEXT:  referenced column: str_to_date
 str_to_date 
-------------
 
(1 row)

-- str_to_date结束
set sql_mode = 'sql_mode_strict,sql_mode_full_group,pipes_as_concat';
\c contrib_regression
DROP DATABASE b_datetime_func_test;
