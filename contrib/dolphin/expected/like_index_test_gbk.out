set enable_indexscan = off;
--GBK
drop database if exists test_gbk;
NOTICE:  database "test_gbk" does not exist, skipping
create database test_gbk dbcompatibility='B' encoding='gbk' LC_CTYPE='zh_CN.gbk' LC_COLLATE='zh_CN.gbk';
\c test_gbk
-- set client_encoding to 'utf8';
--GBK_BIN
--char
create table test_gbk_table_bin_char(c1 char(10))charset GBK collate gbk_bin;
create index on test_gbk_table_bin_char(c1);
insert into test_gbk_table_bin_char values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_char where c1 like 'sde%';
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_char
   Filter: (c1 ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_char_c1_idx
         Index Cond: ((c1 >= 'sde'::bpchar) AND (c1 <= 'sdeþþþþþþþþþþþþþþ'::bpchar))
(4 rows)

select * from test_gbk_table_bin_char where c1 like 'sde%';
     c1     
------------
 sdeWf     
(1 row)

insert into test_gbk_table_bin_char values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_char(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_char where c1 like 'Ð»%';
                                      QUERY PLAN                                       
---------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_char
   Filter: (c1 ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_char_c1_idx
         Index Cond: ((c1 >= 'Ð»'::bpchar) AND (c1 <= 'Ð»þþþþþþþþþþþþþþþþþþ'::bpchar))
(4 rows)

select * from test_gbk_table_bin_char where c1 like 'Ð»%';
       c1       
----------------
 Ð»Ð»ÄãÑ½      
 Ð»þþ        
(2 rows)

--varchar with length without prefix key
create table test_gbk_table_bin_varchar_length_nprefix(c1 varchar(10))charset GBK collate gbk_bin;
create index on test_gbk_table_bin_varchar_length_nprefix(c1);
insert into test_gbk_table_bin_varchar_length_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_varchar_length_nprefix where c1 like 'sde%';
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_length_nprefix
   Filter: ((c1)::text ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_length_nprefix_c1_idx
         Index Cond: (((c1)::text >= 'sde'::text) AND ((c1)::text <= 'sdeþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_length_nprefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_varchar_length_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_varchar_length_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_varchar_length_nprefix where c1 like 'Ð»%';
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_length_nprefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_length_nprefix_c1_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»þþþþþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_length_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar without length without prefix key
create table test_gbk_table_bin_varchar_nlength_nprefix(c1 varchar)charset GBK collate gbk_bin;
create index on test_gbk_table_bin_varchar_nlength_nprefix(c1);
insert into test_gbk_table_bin_varchar_nlength_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_varchar_nlength_nprefix where c1 like 'sde%';
                       QUERY PLAN                       
--------------------------------------------------------
 Seq Scan on test_gbk_table_bin_varchar_nlength_nprefix
   Filter: ((c1)::text ~~ 'sde%'::text)
(2 rows)

select * from test_gbk_table_bin_varchar_nlength_nprefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_varchar_nlength_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_varchar_nlength_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_varchar_nlength_nprefix where c1 like 'Ð»%';
                       QUERY PLAN                       
--------------------------------------------------------
 Seq Scan on test_gbk_table_bin_varchar_nlength_nprefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
(2 rows)

select * from test_gbk_table_bin_varchar_nlength_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar without length with prefix key
create table test_gbk_table_bin_varchar_nlength_prefix(c1 varchar)charset GBK collate gbk_bin;
create index on test_gbk_table_bin_varchar_nlength_prefix(c1(10));
insert into test_gbk_table_bin_varchar_nlength_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_varchar_nlength_prefix where c1 like 'sde%';
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_nlength_prefix
   Filter: ((c1)::text ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_nlength_prefix_expr_idx
         Index Cond: (((c1)::text >= 'sde'::text) AND ((c1)::text <= 'sdeþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_nlength_prefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_varchar_nlength_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_varchar_nlength_prefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_varchar_nlength_prefix where c1 like 'Ð»%';
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_nlength_prefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_nlength_prefix_expr_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»þþþþþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_nlength_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar with length with prefix key
create table test_gbk_table_bin_varchar_length_prefix(c1 varchar(10))charset GBK collate gbk_bin;
create index on test_gbk_table_bin_varchar_length_prefix(c1(2));
insert into test_gbk_table_bin_varchar_length_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_varchar_length_prefix where c1 like 's%';
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_length_prefix
   Filter: ((c1)::text ~~ 's%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_length_prefix_expr_idx
         Index Cond: (((c1)::text >= 's'::text) AND ((c1)::text <= 'sþþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_length_prefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_varchar_length_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_varchar_length_prefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_varchar_length_prefix where c1 like 'Ð»%';
                                    QUERY PLAN                                     
-----------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_varchar_length_prefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_varchar_length_prefix_expr_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»þþ'::text))
(4 rows)

select * from test_gbk_table_bin_varchar_length_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--text without prefix key
create table test_gbk_table_bin_text_nprefix(c1 text)charset GBK collate gbk_bin;
create index on test_gbk_table_bin_text_nprefix(c1);
insert into test_gbk_table_bin_text_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_text_nprefix where c1 like 's%';
                 QUERY PLAN                  
---------------------------------------------
 Seq Scan on test_gbk_table_bin_text_nprefix
   Filter: (c1 ~~ 's%'::text)
(2 rows)

select * from test_gbk_table_bin_text_nprefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_text_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_text_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_text_nprefix where c1 like 'Ð»%';
                 QUERY PLAN                  
---------------------------------------------
 Seq Scan on test_gbk_table_bin_text_nprefix
   Filter: (c1 ~~ 'Ð»%'::text)
(2 rows)

select * from test_gbk_table_bin_text_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--text with prefix key
create table test_gbk_table_bin_text_prefix(c1 text)charset GBK collate gbk_bin;
create index on test_gbk_table_bin_text_prefix(c1(10));
insert into test_gbk_table_bin_text_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_text_prefix where c1 like 's%';
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_text_prefix
   Filter: (c1 ~~ 's%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_text_prefix_expr_idx
         Index Cond: ((c1 >= 's'::text) AND (c1 <= 'sþþþþþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_text_prefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_table_bin_text_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_table_bin_text_prefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_table_bin_text_prefix where c1 like 'Ð»%';
                                    QUERY PLAN                                     
-----------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_text_prefix
   Filter: (c1 ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_text_prefix_expr_idx
         Index Cond: ((c1 >= 'Ð»'::text) AND (c1 <= 'Ð»þþþþþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_table_bin_text_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--GBK_CHINESE_CI
--char
create table test_gbk_chinese_ci_char(c1 char(10))charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_char(c1);
insert into test_gbk_chinese_ci_char values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_char where c1 like 'sde%';
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_char
   Filter: (c1 ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_char_c1_idx
         Index Cond: ((c1 >= 'sde'::bpchar) AND (c1 <= 'sde©g©g©g©g©g©g©g'::bpchar))
(4 rows)

select * from test_gbk_chinese_ci_char where c1 like 'sde%';
     c1     
------------
 sdeWf     
(1 row)

insert into test_gbk_chinese_ci_char values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_char(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_char where c1 like 'Ð»%';
                                      QUERY PLAN                                       
---------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_char
   Filter: (c1 ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_char_c1_idx
         Index Cond: ((c1 >= 'Ð»'::bpchar) AND (c1 <= 'Ð»©g©g©g©g©g©g©g©g©g'::bpchar))
(4 rows)

select * from test_gbk_chinese_ci_char where c1 like 'Ð»%';
       c1       
----------------
 Ð»Ð»ÄãÑ½      
 Ð»þþ        
(2 rows)

--varchar with length without prefix key
create table test_gbk_chinese_ci_varchar_length_nprefix(c1 varchar(10))charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_varchar_length_nprefix(c1);
insert into test_gbk_chinese_ci_varchar_length_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_varchar_length_nprefix where c1 like 'sde%';
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_length_nprefix
   Filter: ((c1)::text ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_length_nprefix_c1_idx
         Index Cond: (((c1)::text >= 'sde'::text) AND ((c1)::text <= 'sde©g©g©g©g©g©g©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_length_nprefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_varchar_length_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_varchar_length_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_varchar_length_nprefix where c1 like 'Ð»%';
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_length_nprefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_length_nprefix_c1_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»©g©g©g©g©g©g©g©g©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_length_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar without length without prefix key
create table test_gbk_chinese_ci_varchar_nlength_nprefix(c1 varchar)charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_varchar_nlength_nprefix(c1);
insert into test_gbk_chinese_ci_varchar_nlength_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_varchar_nlength_nprefix where c1 like 'sde%';
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on test_gbk_chinese_ci_varchar_nlength_nprefix
   Filter: ((c1)::text ~~ 'sde%'::text)
(2 rows)

select * from test_gbk_chinese_ci_varchar_nlength_nprefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_varchar_nlength_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_varchar_nlength_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_varchar_nlength_nprefix where c1 like 'Ð»%';
                       QUERY PLAN                        
---------------------------------------------------------
 Seq Scan on test_gbk_chinese_ci_varchar_nlength_nprefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
(2 rows)

select * from test_gbk_chinese_ci_varchar_nlength_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar without length with prefix key
create table test_gbk_chinese_ci_varchar_nlength_prefix(c1 varchar)charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_varchar_nlength_prefix(c1(10));
insert into test_gbk_chinese_ci_varchar_nlength_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_varchar_nlength_prefix where c1 like 'sde%';
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_nlength_prefix
   Filter: ((c1)::text ~~ 'sde%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_nlength_prefix_expr_idx
         Index Cond: (((c1)::text >= 'sde'::text) AND ((c1)::text <= 'sde©g©g©g©g©g©g©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_nlength_prefix where c1 like 'sde%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_varchar_nlength_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_varchar_nlength_prefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_varchar_nlength_prefix where c1 like 'Ð»%';
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_nlength_prefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_nlength_prefix_expr_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»©g©g©g©g©g©g©g©g©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_nlength_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--varchar with length with prefix key
create table test_gbk_chinese_ci_varchar_length_prefix(c1 varchar(10))charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_varchar_length_prefix(c1(2));
insert into test_gbk_chinese_ci_varchar_length_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_varchar_length_prefix where c1 like 's%';
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_length_prefix
   Filter: ((c1)::text ~~ 's%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_length_prefix_expr_idx
         Index Cond: (((c1)::text >= 's'::text) AND ((c1)::text <= 's©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_length_prefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_varchar_length_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_varchar_length_prefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_varchar_length_prefix where c1 like 'Ð»%';
                                    QUERY PLAN                                     
-----------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_varchar_length_prefix
   Filter: ((c1)::text ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_varchar_length_prefix_expr_idx
         Index Cond: (((c1)::text >= 'Ð»'::text) AND ((c1)::text <= 'Ð»©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_varchar_length_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--text without prefix key
create table test_gbk_chinese_ci_text_nprefix(c1 text)charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_text_nprefix(c1);
insert into test_gbk_chinese_ci_text_nprefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_chinese_ci_text_nprefix where c1 like 's%';
                  QUERY PLAN                  
----------------------------------------------
 Seq Scan on test_gbk_chinese_ci_text_nprefix
   Filter: (c1 ~~ 's%'::text)
(2 rows)

select * from test_gbk_chinese_ci_text_nprefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_text_nprefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_text_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_text_nprefix where c1 like 'Ð»%';
                  QUERY PLAN                  
----------------------------------------------
 Seq Scan on test_gbk_chinese_ci_text_nprefix
   Filter: (c1 ~~ 'Ð»%'::text)
(2 rows)

select * from test_gbk_chinese_ci_text_nprefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
 Ð»þþ
(2 rows)

--text with prefix key
create table test_gbk_chinese_ci_text_prefix(c1 text)charset GBK collate gbk_chinese_ci;
create index on test_gbk_chinese_ci_text_prefix(c1(10));
insert into test_gbk_chinese_ci_text_prefix values('sdeWf'), ('wertf');
explain (costs off) select * from test_gbk_table_bin_text_prefix where c1 like 's%';
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_table_bin_text_prefix
   Filter: (c1 ~~ 's%'::text)
   ->  Bitmap Index Scan on test_gbk_table_bin_text_prefix_expr_idx
         Index Cond: ((c1 >= 's'::text) AND (c1 <= 'sþþþþþþþþþþþþþþþþþþ'::text))
(4 rows)

select * from test_gbk_chinese_ci_text_prefix where c1 like 's%';
  c1   
-------
 sdeWf
(1 row)

insert into test_gbk_chinese_ci_text_prefix values('Ð»Ð»ÄãÑ½'), ('ÐÂÄê¿ìÀÖ');
insert into test_gbk_chinese_ci_text_nprefix(c1) select convert_from('\xD0BBFEFE', 'GBK');
explain (costs off) select * from test_gbk_chinese_ci_text_prefix where c1 like 'Ð»%';
                                    QUERY PLAN                                     
-----------------------------------------------------------------------------------
 Bitmap Heap Scan on test_gbk_chinese_ci_text_prefix
   Filter: (c1 ~~ 'Ð»%'::text)
   ->  Bitmap Index Scan on test_gbk_chinese_ci_text_prefix_expr_idx
         Index Cond: ((c1 >= 'Ð»'::text) AND (c1 <= 'Ð»©g©g©g©g©g©g©g©g©g'::text))
(4 rows)

select * from test_gbk_chinese_ci_text_prefix where c1 like 'Ð»%';
    c1    
----------
 Ð»Ð»ÄãÑ½
(1 row)

reset client_encoding;
