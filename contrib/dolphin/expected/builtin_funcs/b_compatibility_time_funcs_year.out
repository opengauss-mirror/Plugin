create schema b_compatibility_time_funcs_year;
set current_schema to 'b_compatibility_time_funcs_year';
set dolphin.b_compatibility_mode=on;
SET dolphin.sql_mode TO 'sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length';
drop table if exists t_year_0002;
NOTICE:  table "t_year_0002" does not exist, skipping
create table t_year_0002(
c1 int not null,
c2 year default 1991,
c3 year(4),
c4 year);
insert into t_year_0002 values (1, 1901, 1901, 1901);
select c1, extract(year from c2), extract(year from c3),
extract(year from c4) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: extract
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: extract
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: extract
 c1 | extract | extract | extract 
----+---------+---------+---------
  1 |         |         |        
(1 row)

select c1, yearweek(c2), yearweek(c3), yearweek(c4)
from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: yearweek
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: yearweek
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: yearweek
 c1 | yearweek | yearweek | yearweek 
----+----------+----------+----------
  1 |          |          |         
(1 row)

select c1, makedate(c2, 10), makedate(c3, 100), makedate(c4, 1000)
from t_year_0002 order by c1;
 c1 |  makedate  |  makedate  |  makedate  
----+------------+------------+------------
  1 | 1901-01-10 | 1901-04-10 | 1903-09-27
(1 row)

select c1, timestampadd(year, 1, c2), timestampadd(year, 1, c3),
timestampadd(year, 1, c4) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
 c1 | timestampadd | timestampadd | timestampadd 
----+--------------+--------------+--------------
  1 |              |              | 
(1 row)

select c1, timestampadd(day, timestamptz'2000-1-1 1:1:1+05', c2), timestampadd(day, timestamptz'2000-1-1 1:1:1+05', c3),
timestampadd(day, timestamptz'2000-1-1 1:1:1+05', c4) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
 c1 | timestampadd | timestampadd | timestampadd 
----+--------------+--------------+--------------
  1 |              |              | 
(1 row)

select c1, timestampadd(year, '1', c2), timestampadd(year, '1', c3),
timestampadd(year, '1', c4) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampadd
 c1 | timestampadd | timestampadd | timestampadd 
----+--------------+--------------+--------------
  1 |              |              | 
(1 row)

select c1, timestampdiff(year, '2024-01-01', c2),
timestampdiff(year, '2024-01-01', c3),
timestampdiff(year, '2024-01-01', c4)
from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampdiff
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampdiff
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: timestampdiff
 c1 | timestampdiff | timestampdiff | timestampdiff 
----+---------------+---------------+---------------
  1 |               |               |              
(1 row)

select c1, date_add(c2, interval '5' year), date_add(c3, interval '5' year),
date_add(c4, interval '5' year) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_add
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_add
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_add
 c1 | date_add | date_add | date_add 
----+----------+----------+----------
  1 |          |          | 
(1 row)

select c1, date_sub(c2, interval '5' year), date_sub(c3, interval '5' year),
date_sub(c4, interval '5' year) from t_year_0002 order by c1;
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_sub
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_sub
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: date_sub
 c1 | date_sub | date_sub | date_sub 
----+----------+----------+----------
  1 |          |          | 
(1 row)

SELECT timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724') as result;
WARNING:  timestamp out of range
CONTEXT:  referenced column: result
 result 
--------
 
(1 row)

SELECT timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724') as result;
WARNING:  interval out of range
CONTEXT:  referenced column: result
 result 
--------
 
(1 row)

SELECT timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724') as result;
WARNING:  interval out of range
CONTEXT:  referenced column: result
 result 
--------
 
(1 row)

drop table if exists func_test;
NOTICE:  table "func_test" does not exist, skipping
create table func_test(functionName varchar(256), result varchar(256));
insert ignore into func_test(functionName, result) values('extract(year from cast(1901 as year))', extract(year from cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('yearweek(cast(1901 as year))', yearweek(cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: result
insert ignore into func_test(functionName, result) values('makedate(cast(1901 as year), 10)', makedate(cast(1901 as year), 10));
insert ignore into func_test(functionName, result) values('timestampadd(year, 1, cast(1901 as year))', timestampadd(year, 1, cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(day, timestamptz''2000-1-1 1:1:1+05'', cast(1901 as year))', timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year, ''1'', cast(1901 as year))', timestampadd(year, '1', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampdiff(year, ''2024-01-01'', cast(1901 as year))', timestampdiff(year, '2024-01-01', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampdiff(year, cast(1901 as year), ''2024-01-01'')', timestampdiff(year, cast(1901 as year), '2024-01-01'));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('date_add(cast(1901 as year), interval ''5'' year)', date_add(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('date_sub(cast(1901 as year), interval ''5'' year)', date_sub(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+10,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724'));
WARNING:  timestamp out of range
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+30,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+308,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
select * from func_test;
                             functionName                              |   result   
-----------------------------------------------------------------------+------------
 extract(year from cast(1901 as year))                                 | 
 yearweek(cast(1901 as year))                                          | 
 makedate(cast(1901 as year), 10)                                      | 1901-01-10
 timestampadd(year, 1, cast(1901 as year))                             | 
 timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)) | 
 timestampadd(year, '1', cast(1901 as year))                           | 
 timestampdiff(year, '2024-01-01', cast(1901 as year))                 | 
 timestampdiff(year, cast(1901 as year), '2024-01-01')                 | 
 date_add(cast(1901 as year), interval '5' year)                       | 
 date_sub(cast(1901 as year), interval '5' year)                       | 
 timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724')        | 
(13 rows)

truncate table func_test;
insert into func_test(functionName, result) values('extract(year from cast(1901 as year))', extract(year from cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('yearweek(cast(1901 as year))', yearweek(cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: result
insert into func_test(functionName, result) values('makedate(cast(1901 as year), 10)', makedate(cast(1901 as year), 10));
insert into func_test(functionName, result) values('timestampadd(year, 1, cast(1901 as year))', timestampadd(year, 1, cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(day, timestamptz''2000-1-1 1:1:1+05'', cast(1901 as year))', timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year, ''1'', cast(1901 as year))', timestampadd(year, '1', cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampdiff(year, ''2024-01-01'', cast(1901 as year))', timestampdiff(year, '2024-01-01', cast(1901 as year)));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampdiff(year, cast(1901 as year), ''2024-01-01'')', timestampdiff(year, cast(1901 as year), '2024-01-01'));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('date_add(cast(1901 as year), interval ''5'' year)', date_add(cast(1901 as year), interval '5' year));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('date_sub(cast(1901 as year), interval ''5'' year)', date_sub(cast(1901 as year), interval '5' year));
ERROR:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+10,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724'));
ERROR:  timestamp out of range
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+30,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724'));
ERROR:  interval out of range
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+308,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724'));
ERROR:  interval out of range
CONTEXT:  referenced column: result
select * from func_test;
           functionName           |   result   
----------------------------------+------------
 makedate(cast(1901 as year), 10) | 1901-01-10
(1 row)

truncate table func_test;
-- 非严格模式下的写测试
SET dolphin.sql_mode TO 'sql_mode_full_group,pipes_as_concat,ansi_quotes';
insert ignore into func_test(functionName, result) values('extract(year from cast(1901 as year))', extract(year from cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('yearweek(cast(1901 as year))', yearweek(cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: result
insert ignore into func_test(functionName, result) values('makedate(cast(1901 as year), 10)', makedate(cast(1901 as year), 10));
insert ignore into func_test(functionName, result) values('timestampadd(year, 1, cast(1901 as year))', timestampadd(year, 1, cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(day, timestamptz''2000-1-1 1:1:1+05'', cast(1901 as year))', timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year, ''1'', cast(1901 as year))', timestampadd(year, '1', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampdiff(year, ''2024-01-01'', cast(1901 as year))', timestampdiff(year, '2024-01-01', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampdiff(year, cast(1901 as year), ''2024-01-01'')', timestampdiff(year, cast(1901 as year), '2024-01-01'));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('date_add(cast(1901 as year), interval ''5'' year)', date_add(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('date_sub(cast(1901 as year), interval ''5'' year)', date_sub(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+10,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724'));
WARNING:  timestamp out of range
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+30,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
insert ignore into func_test(functionName, result) values('timestampadd(year ,1.212208e+308,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
select * from func_test;
                             functionName                              |   result   
-----------------------------------------------------------------------+------------
 extract(year from cast(1901 as year))                                 | 
 yearweek(cast(1901 as year))                                          | 
 makedate(cast(1901 as year), 10)                                      | 1901-01-10
 timestampadd(year, 1, cast(1901 as year))                             | 
 timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)) | 
 timestampadd(year, '1', cast(1901 as year))                           | 
 timestampdiff(year, '2024-01-01', cast(1901 as year))                 | 
 timestampdiff(year, cast(1901 as year), '2024-01-01')                 | 
 date_add(cast(1901 as year), interval '5' year)                       | 
 date_sub(cast(1901 as year), interval '5' year)                       | 
 timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724')        | 
(13 rows)

truncate table func_test;
insert into func_test(functionName, result) values('extract(year from cast(1901 as year))', extract(year from cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('yearweek(cast(1901 as year))', yearweek(cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: yearweek
SQL function "yearweek" statement 1
referenced column: result
insert into func_test(functionName, result) values('makedate(cast(1901 as year), 10)', makedate(cast(1901 as year), 10));
insert into func_test(functionName, result) values('timestampadd(year, 1, cast(1901 as year))', timestampadd(year, 1, cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(day, timestamptz''2000-1-1 1:1:1+05'', cast(1901 as year))', timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year, ''1'', cast(1901 as year))', timestampadd(year, '1', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampdiff(year, ''2024-01-01'', cast(1901 as year))', timestampdiff(year, '2024-01-01', cast(1901 as year)));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampdiff(year, cast(1901 as year), ''2024-01-01'')', timestampdiff(year, cast(1901 as year), '2024-01-01'));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('date_add(cast(1901 as year), interval ''5'' year)', date_add(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('date_sub(cast(1901 as year), interval ''5'' year)', date_sub(cast(1901 as year), interval '5' year));
WARNING:  Incorrect datetime value: "1901"
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+10,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724'));
WARNING:  timestamp out of range
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+30,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
insert into func_test(functionName, result) values('timestampadd(year ,1.212208e+308,''1995-01-05 06:32:20.859724'')', timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724'));
WARNING:  interval out of range
CONTEXT:  referenced column: result
select * from func_test;
                             functionName                              |   result   
-----------------------------------------------------------------------+------------
 extract(year from cast(1901 as year))                                 | 
 yearweek(cast(1901 as year))                                          | 
 makedate(cast(1901 as year), 10)                                      | 1901-01-10
 timestampadd(year, 1, cast(1901 as year))                             | 
 timestampadd(day, timestamptz'2000-1-1 1:1:1+05', cast(1901 as year)) | 
 timestampadd(year, '1', cast(1901 as year))                           | 
 timestampdiff(year, '2024-01-01', cast(1901 as year))                 | 
 timestampdiff(year, cast(1901 as year), '2024-01-01')                 | 
 date_add(cast(1901 as year), interval '5' year)                       | 
 date_sub(cast(1901 as year), interval '5' year)                       | 
 timestampadd(year ,1.212208e+10,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+30,'1995-01-05 06:32:20.859724')         | 
 timestampadd(year ,1.212208e+308,'1995-01-05 06:32:20.859724')        | 
(13 rows)

drop table if exists func_test cascade;
drop table if exists t_year_0002 cascade;
drop schema b_compatibility_time_funcs_year cascade;
reset current_schema;
