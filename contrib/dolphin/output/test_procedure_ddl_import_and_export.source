--create procedure测试
set dolphin.b_compatibility_mode to off;
drop database if exists dump_procedure_db;
NOTICE:  database "dump_procedure_db" does not exist, skipping
drop database if exists restore_procedure_db;
NOTICE:  database "restore_procedure_db" does not exist, skipping
create database dump_procedure_db lc_collate='C' dbcompatibility = 'B';
create database restore_procedure_db lc_collate='C' dbcompatibility = 'B';
\c dump_procedure_db
create user test_procedure_definer password 'Test@123';
--test language sql
delimiter //;
create definer = test_procedure_definer procedure create_procedure_001() language plpgsql
BEGIN
END;
//
delimiter ;//
--test [not] deterministic
delimiter //;
create definer = test_procedure_definer procedure create_procedure_002() deterministic
BEGIN
END;
//
delimiter ;//
delimiter //;
create definer = test_procedure_definer procedure create_procedure_003() not deterministic
BEGIN
END;
//
delimiter ;//
--test contains sql
delimiter //;
create definer = test_procedure_definer procedure create_procedure_004() contains sql
BEGIN
END;
//
delimiter ;//
--no sql
delimiter //;
create definer = test_procedure_definer procedure create_procedure_005() no sql
BEGIN
END;
//
delimiter ;//
--test reads sql data
delimiter //;
create definer = test_procedure_definer procedure create_procedure_006() reads sql data
BEGIN
END;
//
delimiter ;//
--test modifies sql data
delimiter //;
create definer = test_procedure_definer procedure create_procedure_007() modifies sql data
BEGIN
END;
//
delimiter ;//
--test sql security
delimiter //;
create definer = test_procedure_definer procedure create_procedure_008() sql security definer
BEGIN
END;
//
delimiter ;//
delimiter //;
create definer = test_procedure_definer procedure create_procedure_009() sql security invoker
BEGIN
END;
//
delimiter ;//
--test definer
delimiter //;
create definer = test_procedure_definer procedure create_procedure_010()
BEGIN
END;
//
delimiter ;//
--test select
create table t_create_procedure_select(c int);
insert into t_create_procedure_select values(1);
insert into t_create_procedure_select values(2);
insert into t_create_procedure_select values(3);
create definer = test_procedure_definer procedure create_procedure_011() select c from t_create_procedure_select order by c;
--test repeat
delimiter //;
create definer = test_procedure_definer procedure create_procedure_012(c int)
AS
DECLARE
        i int = 0;
BEGIN
        repeat
                i = i + 1;
                until i > c
        end repeat;
END;
//
delimiter ;//
call create_procedure_012(10);
 create_procedure_012 
----------------------
 
(1 row)

delimiter //;
create definer = test_procedure_definer procedure create_procedure_013(c int)
AS
DECLARE
        i int = 0;
BEGIN
        <<label>> repeat
                i = i + 1;
                until i > c
        end repeat label;
END;
//
delimiter ;//
--test return
delimiter //;
create definer = test_procedure_definer procedure create_procedure_014()
BEGIN
        return;
END;
//
delimiter ;//
delimiter //;
create definer = test_procedure_definer procedure create_procedure_015(c out int)
BEGIN
        return c;
END;
//
delimiter ;//
call create_procedure_015(10);
 c 
---
  
(1 row)

--test declare cursor
create table company(name varchar(100), loc varchar(100), no integer);
insert into company values('macrosoft', 'usa', 001);
insert into company values('oracle', 'usa', 002);
insert into company values('backbery', 'canada', 003);
create definer = test_procedure_definer procedure create_procedure_016
as
        company_name varchar(100);
        company_loc varchar(100);
        company_no integer;
begin
        declare c1_all cursor is
                select name, loc, no from company order by 1, 2, 3;
        if not c1_all%isopen then open c1_all;
        end if;
        loop
                fetch c1_all into company_name, company_loc, company_no;
                exit when c1_all%notfound;
                raise notice '% : % : %', company_name, company_loc, company_no;
        end loop;
        if c1_all%isopen then
                close c1_all;
        end if;
end;
/
--test declare condition
create definer = test_procedure_definer procedure create_procedure_017
AS
BEGIN
        declare DISVISION_ZERO condition for 1;
        raise notice 'declare condition successed';
END;
/
--test do statement
create definer = test_procedure_definer procedure create_procedure_018
AS
DECLARE
        x,y,z int =1;
BEGIN
        y := 2;
        z := 4;
        do x + x;
        do y * z;
        do x + x, y * z;
        do sin(x);
        do pg_sleep(1);
END;
/
--test iterate label
create definer = test_procedure_definer procedure create_procedure_019(c int)
AS
BEGIN
        label1: loop
        c := c + 1;
        if c < 10 then iterate label1;
        end if;
        leave label1;
        end loop label1;
        raise notice 'c:%', c;
END;
/
create definer = test_procedure_definer procedure create_procedure_020(c int)
AS
BEGIN
        loop
                c := c + 1;
                if c < 10 then iterate;
                end if;
                leave;
        end loop;
        raise notice 'c:%', c;
END;
/
--test case when condition
create definer = test_procedure_definer procedure create_procedure_021(c int)
AS
BEGIN
        case c
                when 1 then raise notice 'one';
                when 2 then raise notice'two';
                when 3 then raise notice 'three';
                else
                        raise notice 'more than three';
        end case;
END;
/
--test while
create definer = test_procedure_definer procedure create_procedure_022(c int)
AS
BEGIN
        while c < 10
                do c := c + 1;
        end while;
        raise notice 'c:%', c;
END;
/
create definer = test_procedure_definer procedure create_procedure_023(c int)
AS
BEGIN
        label: while c < 10
                do c := c + 1;
        end while label;
        raise notice 'c:%', c;
END;
/
show lc_collate;
 lc_collate 
------------
 C
(1 row)

show create procedure create_procedure_001;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_001 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_001()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_002;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_002 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_002()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_003;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_003 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_003()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_004;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_004 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_004()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_005;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_005 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_005()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_006;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_006 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_006()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_007;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_007 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_007()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_008;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_008 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_008()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |  SECURITY DEFINER                                                              +|                                                                                                      |                      |                      | 
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_009;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_009 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_009()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_010;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_010 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_010()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_011;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_011 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_011()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                              +|                                                                                                      |                      |                      | 
                      |  select c from t_create_procedure_select order by c;                           +|                                                                                                      |                      |                      | 
                      | END                                                                            +|                                                                                                      |                      |                      | 
                      | ;                                                                              +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_012;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_012 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_012(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                          +|                                                                                                      |                      |                      | 
                      |         i int = 0;                                                                  +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                               +|                                                                                                      |                      |                      | 
                      |         repeat                                                                      +|                                                                                                      |                      |                      | 
                      |                 i = i + 1;                                                          +|                                                                                                      |                      |                      | 
                      |                 until i > c                                                         +|                                                                                                      |                      |                      | 
                      |         end repeat;                                                                 +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_013;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_013 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_013(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                          +|                                                                                                      |                      |                      | 
                      |         i int = 0;                                                                  +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                               +|                                                                                                      |                      |                      | 
                      |         <<label>> repeat                                                            +|                                                                                                      |                      |                      | 
                      |                 i = i + 1;                                                          +|                                                                                                      |                      |                      | 
                      |                 until i > c                                                         +|                                                                                                      |                      |                      | 
                      |         end repeat label;                                                           +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_014;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_014 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_014()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN      return;                                                         +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_015;
      Procedure       |                                     Create Procedure                                     |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_015 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_015(c out int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN      return c;                                                                +|                                                                                                      |                      |                      | 
                      | END;                                                                                    +|                                                                                                      |                      |                      | 
                      |                                                                                          |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_016;
      Procedure       |                                 Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+----------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_016 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_016() +| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE company_name varchar(100);                                          +|                                                                                                      |                      |                      | 
                      |         company_loc varchar(100);                                               +|                                                                                                      |                      |                      | 
                      |         company_no integer;                                                     +|                                                                                                      |                      |                      | 
                      | begin                                                                           +|                                                                                                      |                      |                      | 
                      |         declare c1_all cursor is                                                +|                                                                                                      |                      |                      | 
                      |                 select name, loc, no from company order by 1, 2, 3;             +|                                                                                                      |                      |                      | 
                      |         if not c1_all%isopen then open c1_all;                                  +|                                                                                                      |                      |                      | 
                      |         end if;                                                                 +|                                                                                                      |                      |                      | 
                      |         loop                                                                    +|                                                                                                      |                      |                      | 
                      |                 fetch c1_all into company_name, company_loc, company_no;        +|                                                                                                      |                      |                      | 
                      |                 exit when c1_all%notfound;                                      +|                                                                                                      |                      |                      | 
                      |                 raise notice '% : % : %', company_name, company_loc, company_no;+|                                                                                                      |                      |                      | 
                      |         end loop;                                                               +|                                                                                                      |                      |                      | 
                      |         if c1_all%isopen then                                                   +|                                                                                                      |                      |                      | 
                      |                 close c1_all;                                                   +|                                                                                                      |                      |                      | 
                      |         end if;                                                                 +|                                                                                                      |                      |                      | 
                      | end;                                                                            +|                                                                                                      |                      |                      | 
                      | /                                                                               +|                                                                                                      |                      |                      | 
                      |                                                                                  |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_017;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_017 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_017()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                              +|                                                                                                      |                      |                      | 
                      |         declare DISVISION_ZERO condition for 1;                                +|                                                                                                      |                      |                      | 
                      |         raise notice 'declare condition successed';                            +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_018;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_018 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_018()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                     +|                                                                                                      |                      |                      | 
                      |         x,y,z int =1;                                                          +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                          +|                                                                                                      |                      |                      | 
                      |         y := 2;                                                                +|                                                                                                      |                      |                      | 
                      |         z := 4;                                                                +|                                                                                                      |                      |                      | 
                      |         do x + x;                                                              +|                                                                                                      |                      |                      | 
                      |         do y * z;                                                              +|                                                                                                      |                      |                      | 
                      |         do x + x, y * z;                                                       +|                                                                                                      |                      |                      | 
                      |         do sin(x);                                                             +|                                                                                                      |                      |                      | 
                      |         do pg_sleep(1);                                                        +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_019;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_019 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_019(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                                   +|                                                                                                      |                      |                      | 
                      |         label1: loop                                                                +|                                                                                                      |                      |                      | 
                      |         c := c + 1;                                                                 +|                                                                                                      |                      |                      | 
                      |         if c < 10 then iterate label1;                                              +|                                                                                                      |                      |                      | 
                      |         end if;                                                                     +|                                                                                                      |                      |                      | 
                      |         leave label1;                                                               +|                                                                                                      |                      |                      | 
                      |         end loop label1;                                                            +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_020;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_020 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_020(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                                   +|                                                                                                      |                      |                      | 
                      |         loop                                                                        +|                                                                                                      |                      |                      | 
                      |                 c := c + 1;                                                         +|                                                                                                      |                      |                      | 
                      |                 if c < 10 then iterate;                                             +|                                                                                                      |                      |                      | 
                      |                 end if;                                                             +|                                                                                                      |                      |                      | 
                      |                 leave;                                                              +|                                                                                                      |                      |                      | 
                      |         end loop;                                                                   +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_021;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_021 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_021(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                                   +|                                                                                                      |                      |                      | 
                      |         case c                                                                      +|                                                                                                      |                      |                      | 
                      |                 when 1 then raise notice 'one';                                     +|                                                                                                      |                      |                      | 
                      |                 when 2 then raise notice'two';                                      +|                                                                                                      |                      |                      | 
                      |                 when 3 then raise notice 'three';                                   +|                                                                                                      |                      |                      | 
                      |                 else                                                                +|                                                                                                      |                      |                      | 
                      |                         raise notice 'more than three';                             +|                                                                                                      |                      |                      | 
                      |         end case;                                                                   +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_022;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_022 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_022(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                                   +|                                                                                                      |                      |                      | 
                      |         while c < 10                                                                +|                                                                                                      |                      |                      | 
                      |                 do c := c + 1;                                                      +|                                                                                                      |                      |                      | 
                      |         end while;                                                                  +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_023;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_023 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_023(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS  DECLARE BEGIN                                                                   +|                                                                                                      |                      |                      | 
                      |         label: while c < 10                                                         +|                                                                                                      |                      |                      | 
                      |                 do c := c + 1;                                                      +|                                                                                                      |                      |                      | 
                      |         end while label;                                                            +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

call create_procedure_001();
 create_procedure_001 
----------------------
 
(1 row)

call create_procedure_002();
 create_procedure_002 
----------------------
 
(1 row)

call create_procedure_003();
 create_procedure_003 
----------------------
 
(1 row)

call create_procedure_004();
 create_procedure_004 
----------------------
 
(1 row)

call create_procedure_005();
 create_procedure_005 
----------------------
 
(1 row)

call create_procedure_006();
 create_procedure_006 
----------------------
 
(1 row)

call create_procedure_007();
 create_procedure_007 
----------------------
 
(1 row)

call create_procedure_008();
 create_procedure_008 
----------------------
 
(1 row)

call create_procedure_009();
 create_procedure_009 
----------------------
 
(1 row)

call create_procedure_010();
 create_procedure_010 
----------------------
 
(1 row)

select create_procedure_011();
ERROR:  query has no destination for result data
HINT:  If you want to discard the results of a SELECT, use PERFORM instead.
CONTEXT:  PL/pgSQL function create_procedure_011() line 2 at SQL statement
referenced column: create_procedure_011
call create_procedure_012(10);
 create_procedure_012 
----------------------
 
(1 row)

call create_procedure_013(10);
 create_procedure_013 
----------------------
 
(1 row)

call create_procedure_014();
 create_procedure_014 
----------------------
 
(1 row)

call create_procedure_015(10);
 c 
---
  
(1 row)

call create_procedure_016();
NOTICE:  backbery : canada : 3
NOTICE:  macrosoft : usa : 1
NOTICE:  oracle : usa : 2
 create_procedure_016 
----------------------
 
(1 row)

call create_procedure_017();
NOTICE:  declare condition successed
 create_procedure_017 
----------------------
 
(1 row)

call create_procedure_018();
 create_procedure_018 
----------------------
 
(1 row)

call create_procedure_019(5);
NOTICE:  c:10
 create_procedure_019 
----------------------
 
(1 row)

call create_procedure_020(5);
NOTICE:  c:10
 create_procedure_020 
----------------------
 
(1 row)

call create_procedure_021(5);
NOTICE:  more than three
 create_procedure_021 
----------------------
 
(1 row)

call create_procedure_022(5);
NOTICE:  c:10
 create_procedure_022 
----------------------
 
(1 row)

call create_procedure_023(5);
NOTICE:  c:10
 create_procedure_023 
----------------------
 
(1 row)

--alter procedure测试
--test language sql
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_001() language plpgsql
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_001 language sql;
--test contains sql
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_002() contains sql
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_002 contains sql;
--no sql
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_003() no sql
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_003 no sql;
--test reads sql data
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_004() reads sql data
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_004 reads sql data;
--test modifies sql data
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_005() modifies sql data
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_005 modifies sql data;
--test sql security
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_006() sql security definer
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_006 sql security invoker;
delimiter //;
create definer = test_procedure_definer procedure alter_procedure_007() sql security invoker
BEGIN
END;
//
delimiter ;//
alter procedure alter_procedure_007 sql security definer;
\df+ alter_procedure_001;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_001 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_002;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_002 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_003;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_003 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_004;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_004 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_005;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_005 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_006;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_006 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_007;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_007 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

--导入导出
\! @abs_bindir@/gs_dump dump_procedure_db -p @portstring@ -f @abs_bindir@/dump_procedure.tar -F t >/dev/null 2>&1; echo $?
0
drop procedure create_procedure_001;
drop procedure create_procedure_002;
drop procedure create_procedure_003;
drop procedure create_procedure_004;
drop procedure create_procedure_005;
drop procedure create_procedure_006;
drop procedure create_procedure_007;
drop procedure create_procedure_008;
drop procedure create_procedure_009;
drop procedure create_procedure_010;
drop procedure create_procedure_011;
drop procedure create_procedure_012;
drop procedure create_procedure_013;
drop procedure create_procedure_014;
drop procedure create_procedure_015;
drop procedure create_procedure_016;
drop procedure create_procedure_017;
drop procedure create_procedure_018;
drop procedure create_procedure_019;
drop procedure create_procedure_020;
drop procedure create_procedure_021;
drop procedure create_procedure_022;
drop procedure create_procedure_023;
drop procedure alter_procedure_001;
drop procedure alter_procedure_002;
drop procedure alter_procedure_003;
drop procedure alter_procedure_004;
drop procedure alter_procedure_005;
drop procedure alter_procedure_006;
drop procedure alter_procedure_007;
\! @abs_bindir@/gs_restore -d restore_procedure_db -p @portstring@ @abs_bindir@/dump_procedure.tar >/dev/null 2>&1; echo $?
0
\c restore_procedure_db
show lc_collate;
 lc_collate 
------------
 C
(1 row)

show create procedure create_procedure_001;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_001 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_001()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_002;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_002 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_002()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_003;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_003 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_003()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_004;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_004 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_004()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_005;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_005 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_005()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_006;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_006 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_006()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_007;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_007 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_007()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_008;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_008 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_008()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |  SECURITY DEFINER                                                              +|                                                                                                      |                      |                      | 
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_009;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_009 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_009()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_010;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_010 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_010()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN                                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_011;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_011 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_011()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                               +|                                                                                                      |                      |                      | 
                      |  select c from t_create_procedure_select order by c;                           +|                                                                                                      |                      |                      | 
                      | END                                                                            +|                                                                                                      |                      |                      | 
                      | ;                                                                              +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_012;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_012 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_012(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                          +|                                                                                                      |                      |                      | 
                      |         i int = 0;                                                                  +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                               +|                                                                                                      |                      |                      | 
                      |         repeat                                                                      +|                                                                                                      |                      |                      | 
                      |                 i = i + 1;                                                          +|                                                                                                      |                      |                      | 
                      |                 until i > c                                                         +|                                                                                                      |                      |                      | 
                      |         end repeat;                                                                 +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_013;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_013 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_013(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                          +|                                                                                                      |                      |                      | 
                      |         i int = 0;                                                                  +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                               +|                                                                                                      |                      |                      | 
                      |         <<label>> repeat                                                            +|                                                                                                      |                      |                      | 
                      |                 i = i + 1;                                                          +|                                                                                                      |                      |                      | 
                      |                 until i > c                                                         +|                                                                                                      |                      |                      | 
                      |         end repeat label;                                                           +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_014;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_014 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_014()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN      return;                                                         +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_015;
      Procedure       |                                     Create Procedure                                     |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_015 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_015(c out int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      |     BEGIN      return c;                                                                +|                                                                                                      |                      |                      | 
                      | END;                                                                                    +|                                                                                                      |                      |                      | 
                      |                                                                                          |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_016;
      Procedure       |                                 Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+----------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_016 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_016() +| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE company_name varchar(100);                                           +|                                                                                                      |                      |                      | 
                      |         company_loc varchar(100);                                               +|                                                                                                      |                      |                      | 
                      |         company_no integer;                                                     +|                                                                                                      |                      |                      | 
                      | begin                                                                           +|                                                                                                      |                      |                      | 
                      |         declare c1_all cursor is                                                +|                                                                                                      |                      |                      | 
                      |                 select name, loc, no from company order by 1, 2, 3;             +|                                                                                                      |                      |                      | 
                      |         if not c1_all%isopen then open c1_all;                                  +|                                                                                                      |                      |                      | 
                      |         end if;                                                                 +|                                                                                                      |                      |                      | 
                      |         loop                                                                    +|                                                                                                      |                      |                      | 
                      |                 fetch c1_all into company_name, company_loc, company_no;        +|                                                                                                      |                      |                      | 
                      |                 exit when c1_all%notfound;                                      +|                                                                                                      |                      |                      | 
                      |                 raise notice '% : % : %', company_name, company_loc, company_no;+|                                                                                                      |                      |                      | 
                      |         end loop;                                                               +|                                                                                                      |                      |                      | 
                      |         if c1_all%isopen then                                                   +|                                                                                                      |                      |                      | 
                      |                 close c1_all;                                                   +|                                                                                                      |                      |                      | 
                      |         end if;                                                                 +|                                                                                                      |                      |                      | 
                      | end;                                                                            +|                                                                                                      |                      |                      | 
                      | /                                                                               +|                                                                                                      |                      |                      | 
                      |                                                                                  |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_017;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_017 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_017()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                               +|                                                                                                      |                      |                      | 
                      |         declare DISVISION_ZERO condition for 1;                                +|                                                                                                      |                      |                      | 
                      |         raise notice 'declare condition successed';                            +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_018;
      Procedure       |                                Create Procedure                                 |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+---------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_018 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_018()+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE                                                                     +|                                                                                                      |                      |                      | 
                      |         x,y,z int =1;                                                          +|                                                                                                      |                      |                      | 
                      | BEGIN                                                                          +|                                                                                                      |                      |                      | 
                      |         y := 2;                                                                +|                                                                                                      |                      |                      | 
                      |         z := 4;                                                                +|                                                                                                      |                      |                      | 
                      |         do x + x;                                                              +|                                                                                                      |                      |                      | 
                      |         do y * z;                                                              +|                                                                                                      |                      |                      | 
                      |         do x + x, y * z;                                                       +|                                                                                                      |                      |                      | 
                      |         do sin(x);                                                             +|                                                                                                      |                      |                      | 
                      |         do pg_sleep(1);                                                        +|                                                                                                      |                      |                      | 
                      | END;                                                                           +|                                                                                                      |                      |                      | 
                      | /                                                                              +|                                                                                                      |                      |                      | 
                      |                                                                                 |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_019;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_019 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_019(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                                    +|                                                                                                      |                      |                      | 
                      |         label1: loop                                                                +|                                                                                                      |                      |                      | 
                      |         c := c + 1;                                                                 +|                                                                                                      |                      |                      | 
                      |         if c < 10 then iterate label1;                                              +|                                                                                                      |                      |                      | 
                      |         end if;                                                                     +|                                                                                                      |                      |                      | 
                      |         leave label1;                                                               +|                                                                                                      |                      |                      | 
                      |         end loop label1;                                                            +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_020;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_020 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_020(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                                    +|                                                                                                      |                      |                      | 
                      |         loop                                                                        +|                                                                                                      |                      |                      | 
                      |                 c := c + 1;                                                         +|                                                                                                      |                      |                      | 
                      |                 if c < 10 then iterate;                                             +|                                                                                                      |                      |                      | 
                      |                 end if;                                                             +|                                                                                                      |                      |                      | 
                      |                 leave;                                                              +|                                                                                                      |                      |                      | 
                      |         end loop;                                                                   +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_021;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_021 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_021(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                                    +|                                                                                                      |                      |                      | 
                      |         case c                                                                      +|                                                                                                      |                      |                      | 
                      |                 when 1 then raise notice 'one';                                     +|                                                                                                      |                      |                      | 
                      |                 when 2 then raise notice'two';                                      +|                                                                                                      |                      |                      | 
                      |                 when 3 then raise notice 'three';                                   +|                                                                                                      |                      |                      | 
                      |                 else                                                                +|                                                                                                      |                      |                      | 
                      |                         raise notice 'more than three';                             +|                                                                                                      |                      |                      | 
                      |         end case;                                                                   +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_022;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_022 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_022(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                                    +|                                                                                                      |                      |                      | 
                      |         while c < 10                                                                +|                                                                                                      |                      |                      | 
                      |                 do c := c + 1;                                                      +|                                                                                                      |                      |                      | 
                      |         end while;                                                                  +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

show create procedure create_procedure_023;
      Procedure       |                                   Create Procedure                                   |                                               sql_mode                                               | character_set_client | collation_connection | Database Collation 
----------------------+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------
 create_procedure_023 | CREATE DEFINER = test_procedure_definer PROCEDURE public.create_procedure_023(c int)+| sql_mode_strict,sql_mode_full_group,pipes_as_concat,ansi_quotes,no_zero_date,pad_char_to_full_length | UTF8                 | C                    | C
                      | AS DECLARE BEGIN                                                                    +|                                                                                                      |                      |                      | 
                      |         label: while c < 10                                                         +|                                                                                                      |                      |                      | 
                      |                 do c := c + 1;                                                      +|                                                                                                      |                      |                      | 
                      |         end while label;                                                            +|                                                                                                      |                      |                      | 
                      |         raise notice 'c:%', c;                                                      +|                                                                                                      |                      |                      | 
                      | END;                                                                                +|                                                                                                      |                      |                      | 
                      | /                                                                                   +|                                                                                                      |                      |                      | 
                      |                                                                                      |                                                                                                      |                      |                      | 
(1 row)

call create_procedure_001();
 create_procedure_001 
----------------------
 
(1 row)

call create_procedure_002();
 create_procedure_002 
----------------------
 
(1 row)

call create_procedure_003();
 create_procedure_003 
----------------------
 
(1 row)

call create_procedure_004();
 create_procedure_004 
----------------------
 
(1 row)

call create_procedure_005();
 create_procedure_005 
----------------------
 
(1 row)

call create_procedure_006();
 create_procedure_006 
----------------------
 
(1 row)

call create_procedure_007();
 create_procedure_007 
----------------------
 
(1 row)

call create_procedure_008();
 create_procedure_008 
----------------------
 
(1 row)

call create_procedure_009();
 create_procedure_009 
----------------------
 
(1 row)

call create_procedure_010();
 create_procedure_010 
----------------------
 
(1 row)

select create_procedure_011();
ERROR:  query has no destination for result data
HINT:  If you want to discard the results of a SELECT, use PERFORM instead.
CONTEXT:  PL/pgSQL function create_procedure_011() line 2 at SQL statement
referenced column: create_procedure_011
call create_procedure_012(10);
 create_procedure_012 
----------------------
 
(1 row)

call create_procedure_013(10);
 create_procedure_013 
----------------------
 
(1 row)

call create_procedure_014();
 create_procedure_014 
----------------------
 
(1 row)

call create_procedure_015(10);
 c 
---
  
(1 row)

call create_procedure_016();
NOTICE:  backbery : canada : 3
NOTICE:  macrosoft : usa : 1
NOTICE:  oracle : usa : 2
 create_procedure_016 
----------------------
 
(1 row)

call create_procedure_017();
NOTICE:  declare condition successed
 create_procedure_017 
----------------------
 
(1 row)

call create_procedure_018();
 create_procedure_018 
----------------------
 
(1 row)

call create_procedure_019(5);
NOTICE:  c:10
 create_procedure_019 
----------------------
 
(1 row)

call create_procedure_020(5);
NOTICE:  c:10
 create_procedure_020 
----------------------
 
(1 row)

call create_procedure_021(5);
NOTICE:  more than three
 create_procedure_021 
----------------------
 
(1 row)

call create_procedure_022(5);
NOTICE:  c:10
 create_procedure_022 
----------------------
 
(1 row)

call create_procedure_023(5);
NOTICE:  c:10
 create_procedure_023 
----------------------
 
(1 row)

\df+ alter_procedure_001;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_001 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_002;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_002 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_003;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_003 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_004;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_004 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_005;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_005 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_006;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_006 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\df+ alter_procedure_007;
                                                                                         List of functions
 Schema |        Name         | Result data type | Argument data types |  Type  | Volatility |         Owner          | Language |  Source code   | Description | fencedmode | propackage | prokind 
--------+---------------------+------------------+---------------------+--------+------------+------------------------+----------+----------------+-------------+------------+------------+---------
 public | alter_procedure_007 | void             |                     | normal | volatile   | test_procedure_definer | plpgsql  |  BEGIN_B_PROC +|             | f          | f          | p
        |                     |                  |                     |        |            |                        |          | END            |             |            |            | 
(1 row)

\c postgres
drop database if exists restore_procedure_db;
drop database if exists dump_procedure_db;
drop user test_procedure_definer;
